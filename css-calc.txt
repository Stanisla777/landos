// –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
document.addEventListener('DOMContentLoaded', function () {
  setTimeout(() => {
    document.addEventListener('click', function (e) {
      const buttonSelector = '.js--btn-registration-state';
      const btn = document.querySelector(buttonSelector);
      if (!btn || !e.target.closest(buttonSelector)) return;

      e.preventDefault();
      console.log('‚úÖ –ö–ª–∏–∫ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω –Ω–∞ —Ñ–∞–∑–µ CAPTURE');

      const container = btn.closest('.feed_back__wr-checkbox') || btn.closest('form') || document;
      const checkboxWrappers = container.querySelectorAll('.js--checkbox_wrapper');
      const errorClass = 'js--input__error_required';

      let hasError = false;

      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ—à–∏–±–∫–∏ –∏ –∫–ª–∞—Å—Å—ã
      checkboxWrappers.forEach(wrapper => {
        const formBlock = wrapper.querySelector('.feed_back__user-form-block');
        if (formBlock) {
          const error = formBlock.querySelector('.' + errorClass);
          if (error) error.remove();
        }
        wrapper.classList.remove('input_error'); // —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –æ—à–∏–±–∫–∏
      });

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ–∫–±–æ–∫—Å—ã
      checkboxWrappers.forEach(wrapper => {
        const checkbox = wrapper.querySelector('input[type="checkbox"]');
        const formBlock = wrapper.querySelector('.feed_back__user-form-block');

        if (!checkbox || !formBlock) return;

        if (checkbox.hasAttribute('required') && !checkbox.checked) {
          const message = checkbox.getAttribute('data-required-hint') || '–°–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏';
          const error = document.createElement('p');
          error.className = 'input__error ' + errorClass;
          error.textContent = message;
          formBlock.appendChild(error);
          wrapper.classList.add('input_error'); // –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –æ–±—ë—Ä—Ç–∫–µ
          hasError = true;
        }
      });

      if (hasError) {
        console.log('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞');
        return;
      }

      // –í—ã–ø–æ–ª–Ω—è–µ–º onclick
      const onclickAttr = btn.getAttribute('onclick');
      console.log('‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞. –í—ã–ø–æ–ª–Ω—è–µ–º:', onclickAttr);
      if (onclickAttr) {
        try {
          new Function(onclickAttr)();
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è onclick:', err);
        }
      }
    }, true);

    console.log('üîê –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }, 100);
});
