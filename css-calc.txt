// tooltipMobile.js

import bodyLockMobileFilter from './redesign-site/body-lock-mobile-filter';
import bodyUnlockMobileFilter from './redesign-site/body-unlock-mobile-filter';

function openTooltipMobile() {
  const array_mobile_tooltip = document.querySelectorAll('.js--open-mobile-tooltip');
  for (let item of array_mobile_tooltip) {
    item.onclick = () => {
      const parent = item.closest('.js--tooltip-parent');
      if (parent) {
        parent.classList.add('active');
        bodyLockMobileFilter(parent);
      }
    };
  }
}

function closeTooltipMobile() {
  const array_mobile_tooltip_close = document.querySelectorAll('.js--close-mobile-tooltip');
  for (let item of array_mobile_tooltip_close) {
    item.onclick = () => {
      const parent = item.closest('.js--tooltip-parent');
      if (parent) {
        parent.classList.remove('active');
        bodyUnlockMobileFilter(parent);
      }
    };
  }
}

// 🔥 НОВАЯ ФУНКЦИЯ: закрыть все мобильные тултипы
function closeAllMobileTooltips() {
  const activeParents = document.querySelectorAll('.js--tooltip-parent.active');
  activeParents.forEach(parent => {
    parent.classList.remove('active');
    bodyUnlockMobileFilter(parent);
  });
}

// 🔥 НОВАЯ ФУНКЦИЯ: обработчик ресайза
function handleResize() {
  // Порог из ваших медиазапросов: 480px
  if (window.innerWidth > 480) {
    closeAllMobileTooltips();
  }
}

// Экспорт и инициализация
export default function tooltipMobile() {
  openTooltipMobile();
  closeTooltipMobile();

  // Добавляем слушатель ресайза
  window.addEventListener('resize', handleResize);

  // Опционально: сразу проверить при загрузке (на случай, если страница открыта на десктопе)
  if (window.innerWidth > 480) {
    closeAllMobileTooltips();
  }
}
