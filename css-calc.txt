
------------------------------------

import SingleCalculator from './modules/single-calculator/SingleCalculatorEntry.vue';

function initSingleCalculator() {
  const el = document.getElementById('v-single-calculator');
  if (!el) {
    console.log('Element #v-single-calculator not found');
    return;
  }

  // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  if (el.__vue__) {
    console.log('Vue already initialized on #v-single-calculator');
    return;
  }

  let attempts = 0;
  const maxAttempts = 2; // 2 –ø–æ–ø—ã—Ç–∫–∏ –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ

  function initialize() {
    attempts++;
    console.log(`Initializing SingleCalculator Vue app, attempt ${attempts}`);

    try {
      // eslint-disable-next-line no-new
      new Vue({
        el: '#v-single-calculator',
        components: {
          'single-calculator': SingleCalculator
        },
        errorCaptured(err, vm, info) {
          console.warn('Vue error in SingleCalculator:', err.message);
          // false = –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
          return false;
        }
      });

      console.log('‚úÖ SingleCalculator initialized successfully');
      
    } catch (error) {
      console.error(`‚ùå Failed to initialize SingleCalculator (attempt ${attempts}):`, error);
      
      if (attempts < maxAttempts) {
        const delay = attempts * 500; // 500ms, 1000ms
        console.log(`üîÑ Retrying in ${delay}ms...`);
        setTimeout(initialize, delay);
      } else {
        console.error('üí• All initialization attempts failed');
        showFallbackMessage(el);
      }
    }
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
  setTimeout(initialize, 100);
}

function showFallbackMessage(element) {
  element.innerHTML = `
    <div style="padding: 20px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; text-align: center;">
      <p style="margin: 0; color: #6c757d;">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</p>
    </div>
  `;
}





mounted() {
  try {
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
    this.initRealtySlider()
    this.initRealtySlider_2()
    
    // 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    const this_year = new Date().getFullYear()
    this.selected_year = this_year - 1
    let year = this_year
    this.array_year.push(year)
    for (let i = 0; i <= 2; i++) {
      year -= 1
      this.array_year.push(year)
    }
    
    this.dataInputIndex()
    
    // 3. –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞)
    setTimeout(() => {
      this.screenWidthSider()
      this.heightBlockSticky()
      catalogNew();
      
      if (this.$refs.BtnChildFirst) {
        this.$refs.BtnChildFirst.click()
      }
    }, 500)
    
    // 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    window.addEventListener('resize', this.updateScreenWidth);
    
  } catch (error) {
    console.error('Error in SingleCalculator mounted:', error);
    throw error;
  }
}

------------------------------

fieldCalculation(e) {
  try {
    const element = e.currentTarget;
    const main_container = element.closest('.js--tax-deduc-cont-prof')
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
  } catch (error) {
    console.error('Field calculation error:', error)
  }
}


------------------------------------

errorMessage() {
  this.$nextTick(() => {
    try {
      const totalStr = String(this.total_calculate);
      const deductionStr = String(this.dataField_deduction);
      
      const totalNum = parseInt(totalStr.replace(/\s/g, ''), 10) || 0;
      const deductionNum = parseInt(deductionStr.replace(/\s/g, ''), 10) || 0;

      let shouldShowError = false;

      if (totalNum > 0 && deductionNum > 0 && totalNum > deductionNum) {
        shouldShowError = true;
      } else if (totalNum > 0 && deductionNum === 0) {
        shouldShowError = true;
      } else if (totalNum === 0 && deductionNum > 0) {
        shouldShowError = false;
      } else {
        shouldShowError = false;
      }

      this.error_message = shouldShowError;
    } catch (error) {
      console.error('Error message calculation error:', error)
      this.error_message = false;
    }
  });
}



