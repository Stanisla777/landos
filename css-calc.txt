// –í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ —Ü–µ–ª–∏–∫–æ–º –≤ –∫–æ–Ω—Å–æ–ª—å
document.addEventListener('DOMContentLoaded', function () {
  setTimeout(() => {
    document.addEventListener('click', function (e) {
      const buttonSelector = '.js--btn-registration-state';
      const btn = document.querySelector(buttonSelector);
      if (!btn || !e.target.closest(buttonSelector)) return;

      e.preventDefault();
      console.log('‚úÖ –ö–ª–∏–∫ –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω –Ω–∞ —Ñ–∞–∑–µ CAPTURE');

      const container = btn.closest('.feed_back__wr-checkbox') || btn.closest('form') || document;
      const checkboxWrappers = container.querySelectorAll('.js--checkbox_wrapper');
      const errorClass = 'js--input__error_required';

      let hasError = false;

      checkboxWrappers.forEach(wrapper => {
        const formBlock = wrapper.querySelector('.feed_back__user-form-block');
        if (formBlock) {
          const error = formBlock.querySelector('.' + errorClass);
          if (error) error.remove();
        }
      });

      checkboxWrappers.forEach(wrapper => {
        const checkbox = wrapper.querySelector('input[type="checkbox"]');
        const formBlock = wrapper.querySelector('.feed_back__user-form-block');

        if (!checkbox || !formBlock) return;

        if (checkbox.hasAttribute('required') && !checkbox.checked) {
          const message = checkbox.getAttribute('data-required-hint') || '–°–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏';
          const error = document.createElement('p');
          error.className = 'input__error ' + errorClass;
          error.textContent = message;
          formBlock.appendChild(error);
          hasError = true;
        }
      });

      if (hasError) {
        console.log('‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞');
        return;
      }

      const onclickAttr = btn.getAttribute('onclick');
      console.log('‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞. –í—ã–ø–æ–ª–Ω—è–µ–º:', onclickAttr);
      if (onclickAttr) {
        try {
          new Function(onclickAttr)();
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è onclick:', err);
        }
      }
    }, true);

    console.log('üîê –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
  }, 100);
});
