// ОБРАБОТЧИК НАВЕДЕНИЯ
function handleMouseOver(e) {
  // Проверяю, что e.target существует и имеет метод closest
  if (!e.target || typeof e.target.closest !== 'function') return;

  // === НАХОЖУ ТРИГГЕР: ищем .js--content-note-new, включая самого элемента и его потомков ===
  const trigger = e.target.closest('.js--content-note-new');
  if (!trigger) return;

  // === Проверяю, есть ли класс not-use-tooltip у триггера или его потомков ===
  const hasNotUseTooltip = trigger.classList.contains('not-use-tooltip') || 
                          trigger.querySelector('.not-use-tooltip');
  if (hasNotUseTooltip) {
    return;
  }

  // === Проверяю, есть ли класс для отключения на мобильных ===
  if (isMobileDevice() && trigger.classList.contains('not-use-tooltip-mobile')) {
    return;
  }

  // Читаю контент именно из этого элемента
  const content = trigger.dataset.contentText || '';

  // === Дополнительная проверка на пустой контент ===
  if (!content || content.trim() === '') {
    console.warn('Тултип не показан: отсутствует или пустой атрибут data-content-text', trigger);
    return;
  }

  // Если уже открыт тултип для этого же блока - ничего не делаю
  if (activeTooltip && activeTrigger === trigger) {
    return;
  }

  // Отменяю предыдущий таймер закрытия
  if (tooltipCloseTimer) {
    clearTimeout(tooltipCloseTimer);
    tooltipCloseTimer = null;
  }

  // Показываю тултип с контентом из именно блока по который навели
  showTooltip(trigger, content);
}

-------------------------------------------------------------------------------------------

// ОБРАБОТЧИК КЛИКА ДЛЯ МОБИЛЬНЫХ
function handleClick(e) {
  // Проверяю, что e.target существует и имеет метод closest
  if (!e.target || typeof e.target.closest !== 'function') return;

  const trigger = e.target.closest('.js--content-note-new');
  if (!trigger) return;

  // === Проверяю, есть ли класс not-use-tooltip у триггера или его потомков ===
  const hasNotUseTooltip = trigger.classList.contains('not-use-tooltip') || 
                          trigger.querySelector('.not-use-tooltip');
  if (hasNotUseTooltip) {
    return;
  }

  // === Проверяю, есть ли класс для отключения на всех тач-устройствах (телефоны + планшеты) ===
  if (isMobileDevice() && trigger.classList.contains('not-use-tooltip-mobile')) {
    return;
  }

  // === Читаю контент именно из этого элемента ===
  const content = trigger.dataset.contentText || '';

  // === Дополнительная проверка на пустой контент ===
  if (!content || content.trim() === '') {
    console.warn('Тултип не показан: отсутствует или пустой атрибут data-content-text', trigger);
    return;
  }

  // Предотвращаю стандартное поведение
  e.preventDefault();

  // Если тултип уже открыт для этого же триггера - закрываем
  if (activeTooltip && activeTrigger === trigger) {
    hideTooltip(activeTooltip);
    return;
  }

  // Показываю тултип с контентом из блока по которому кликнули
  showTooltip(trigger, content);
}
