Ð”ÐµÐ¼Ð¾-ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ñ Ð²Ð¸Ð´ÐµÐ¾:
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-vkvideo-ru/
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-rutube-ru/

Ð’Ð¸Ð´ÐµÐ¾ Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ñ„Ð°Ð¹Ð»Ð°Ð¼Ð¸:

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/sberezhenie-sredstv-v-krizisnoy-situatsii/

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/keshbek-dlya-zhizni-kak-vernut-potrachennye-dengi/



function initShareBlocks() {
  const triggers = document.querySelectorAll('.js--soc-list-share:not([data-initialized])');
  triggers.forEach(trigger => {
    trigger.dataset.initialized = 'true';
    trigger.addEventListener('click', handleShareClick);
  });
}

function handleShareClick(e) {
  e.preventDefault();
  const trigger = e.currentTarget;
  const wrapper = trigger.closest('.js--soc-list-wrapper-share');
  if (!wrapper) return;

  let dropdown = wrapper.querySelector('.soc-list__share');
  if (!dropdown) {
    dropdown = createShareDropdown(wrapper);
    wrapper.appendChild(dropdown);
  }

  // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼, Ð¿Ð¾Ñ‚Ð¾Ð¼ â€” Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€ÑƒÐµÐ¼ Ð² ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ñ„Ñ€ÐµÐ¹Ð¼Ðµ
  dropdown.style.display = 'block';
  requestAnimationFrame(() => {
    positionDropdown(trigger, dropdown);
  });
}

function positionDropdown(trigger, dropdown) {
  const rect = trigger.getBoundingClientRect();

  // Ð”Ð»Ñ position: fixed â€” ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ Ð‘Ð•Ð— scrollTop/Left!
  const top = rect.top + rect.height + 10;   // Ð¿Ð¾Ð´ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹
  const left = rect.left;               // Ð¿Ð¾ Ð»ÐµÐ²Ð¾Ð¼Ñƒ ÐºÑ€Ð°ÑŽ ÐºÐ½Ð¾Ð¿ÐºÐ¸

  dropdown.style.top = `${top}px`;
  dropdown.style.left = `${left}px`;

  // Ð”Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸:
  console.log('ðŸŽ¯ rect.top:', rect.top, 'â†’ dropdown top:', top);
}

function createShareDropdown(wrapper) {
  // === ÐŸÐ°Ñ€ÑÐ¸Ð½Ð³ data-services (ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾, Ð±ÐµÐ· Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ñ… try/catch) ===
  const servicesStr = (wrapper.dataset.services || '').trim();
  let services = [];

  if (servicesStr) {
    try {
      services = JSON.parse(servicesStr);
    } catch (_) {
      let cleaned = servicesStr.trim();
      if (cleaned.startsWith('[') && cleaned.endsWith(']')) {
        cleaned = cleaned.slice(1, -1).trim();
      }
      services = cleaned.split(',').map(s => s.trim()).filter(Boolean);
    }
  }

  if (!Array.isArray(services)) services = [];

  // === Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ ÑˆÐ°Ñ€Ð¸Ð½Ð³Ð° ===
  const rawUrl = wrapper.dataset.url || location.href;
  const rawText = wrapper.dataset.text || document.title;
  const rawImage = wrapper.dataset.image || '';

  const url = encodeURIComponent(rawUrl);
  const text = encodeURIComponent(rawText);
  const imageUrl = encodeURIComponent(rawImage);

  // === Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ DOM ===
  const dropdown = document.createElement('div');
  dropdown.className = 'soc-list__share';
  dropdown.style.display = 'none';

  const ul = document.createElement('ul');

  const serviceTitles = {
    whatsapp: 'WhatsApp',
    telegram: 'Telegram',
    vkontakte: 'Ð’ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ðµ',
    odnoklassniki: 'ÐžÐ´Ð½Ð¾ÐºÐ»Ð°ÑÑÐ½Ð¸ÐºÐ¸',
  };

  // Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹
  services.forEach(service => {
    const title = serviceTitles[service];
    if (!title) return;

    const li = document.createElement('li');
    const a = document.createElement('a');
    const icon = document.createElement('div');
    const span = document.createElement('span');

    // âœ… ÐšÐ»Ð°ÑÑÑ‹ Ð²Ð¸Ð´Ð° "whatsapp-icon-share"
    icon.className = `soc-list__share-icon ${service}-icon-share`;
    span.className = 'soc-list__share-title';
    span.textContent = title;

    a.href = getShareUrl(service, { url, text, imageUrl });
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.appendChild(icon);
    a.appendChild(span);

    li.appendChild(a);
    ul.appendChild(li);
  });

  // === ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑÑ‹Ð»ÐºÐ¸ ===
  const copyLi = document.createElement('li');
  const copyDiv = document.createElement('div');
  copyDiv.className = 'soc-list__copy-link';
  copyDiv.dataset.copyLink = '';

  const copyIcon = document.createElement('div');
  copyIcon.className = 'soc-list__share-icon copy-link';

  const copyTitle = document.createElement('span');
  copyTitle.className = 'soc-list__share-title';
  copyTitle.textContent = 'Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ';

  copyDiv.appendChild(copyIcon);
  copyDiv.appendChild(copyTitle);
  copyLi.appendChild(copyDiv);
  ul.appendChild(copyLi);

  dropdown.appendChild(ul);

  // === ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ===
  copyDiv.addEventListener('click', function (ev) {
    ev.stopPropagation();
    const titleEl = copyTitle;
    if (!titleEl) return;

    const originalText = 'Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ';
    const successText = 'Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾';

    if (copyDiv.dataset.timeoutId) {
      clearTimeout(parseInt(copyDiv.dataset.timeoutId, 10));
      delete copyDiv.dataset.timeoutId;
    }

    const copy = () => {
      // âœ… Ð¡Ð¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
      if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
        return navigator.clipboard.writeText(rawUrl);
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = rawUrl;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(textarea);
        return ok ? Promise.resolve() : Promise.reject(new Error('copy failed'));
      }
    };

    copy()
      .then(() => {
        titleEl.textContent = successText;
        const tid = setTimeout(() => {
          titleEl.textContent = originalText;
          delete copyDiv.dataset.timeoutId;
        }, 3000);
        copyDiv.dataset.timeoutId = String(tid);
      })
      .catch(err => {
        console.warn('ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑÑ‹Ð»ÐºÑƒ:', err);
      });
  });

  // === Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¿Ð¾ ÐºÐ»Ð¸ÐºÑƒ Ð½Ð° Ð¿ÑƒÐ½ÐºÑ‚ (ÐºÑ€Ð¾Ð¼Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ) ===
  dropdown.addEventListener('click', (ev) => {
    const clickedOnItem = ev.target.closest('a');
    if (clickedOnItem) {
      dropdown.style.display = 'none';
    }
  });

  // === Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¿Ð¾ ÐºÐ»Ð¸ÐºÑƒ Ð²Ð½Ðµ dropdown Ð¸ ÐºÐ½Ð¾Ð¿Ð¾Ðº share ===
  document.addEventListener('click', function closeOnClickOutside(ev) {
    if (
      dropdown.style.display === 'block' &&
      !dropdown.contains(ev.target) &&
      !ev.target.closest('.js--soc-list-share')
    ) {
      dropdown.style.display = 'none';
    }
  });

  return dropdown;
}

function getShareUrl(service, { url, text, imageUrl }) {
  switch (service) {
    case 'whatsapp':
      return `https://wa.me/?text=${text}%20${url}`;
    case 'telegram':
      return `https://t.me/share/url?url=${url}&text=${text}`;
    case 'vkontakte':
      return `https://vk.com/share.php?url=${url}&title=${text}&image=${imageUrl}&noparse=true`;
    case 'odnoklassniki':
      return `https://connect.ok.ru/offer?url=${url}&title=${text}&imageUrl=${imageUrl}`;
    default:
      return '#';
  }
}

export default function shareSocList() {
  initShareBlocks();
}








