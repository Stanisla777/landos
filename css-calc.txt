//–°–µ–∫—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π

createSheduleBlocks() {
  const blocks = [];
  const totalItems = this.shedule.length;

  this.shedule.forEach((item, index) => {
    const hasNextItem = index < totalItems - 1;
    const nextItem = hasNextItem ? this.shedule[index + 1] : null;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ (–±–µ–∑ ?.)
    const nextIsPayment = nextItem && 
      !nextItem.isHoliday && 
      (!(nextItem.prepayments && nextItem.prepayments.length > 0));

    const nextIsEarly = nextItem && 
      !nextItem.isHoliday && 
      nextItem.prepayments && 
      nextItem.prepayments.length > 0;

    const nextIsHoliday = nextItem && nextItem.isHoliday;

    if (item.isHoliday) {
      // === –ò–ü–û–¢–ï–ß–ù–´–ï –ö–ê–ù–ò–ö–£–õ–´ ===
      let holidayCounter = 0;
      for (let i = index; i >= 0 && this.shedule[i].isHoliday; i--) {
        holidayCounter++;
      }

      const blockHeight = holidayCounter === 1 ? 59 : 43;
      const contentWidth = 515 - 16 - 16;
      const badgeHeight = this.converPx(20);

      const isLastHolidayBlock = 
        (index === totalItems - 1) || 
        (!this.shedule[index + 1].isHoliday);

      blocks.push({
        stack: [
          {
            canvas: [{
              type: 'rect',
              x: 0, y: 0, w: contentWidth, r: 8, h: blockHeight, color: '#f4f4f4'
            }],
            margin: [0, 0, 0, -blockHeight]
          },
          {
            stack: [
              ...(holidayCounter === 1 ? [{
                stack: [
                  {
                    canvas: [{
                      type: 'rect',
                      x: 0, y: 0, w: this.converPx(135), h: badgeHeight, r: 4, color: '#252628'
                    }],
                    margin: [0, 0, 0, -badgeHeight]
                  },
                  {
                    text: '–ò–ø–æ—Ç–µ—á–Ω—ã–µ –∫–∞–Ω–∏–∫—É–ª—ã',
                    style: 'holidayBadgeText',
                    margin: [this.converPx(8), 4, this.converPx(8), 3]
                  }
                ],
                margin: [this.converPx(16), 0, this.converPx(16), this.converPx(11)]
              }] : []),
              {
                columns: [
                  {
                    width: 120,
                    stack: [{
                      text: `${this.$options.filters.capitalize(item.nameMonth)} ${item.year}`,
                      style: 'sheduleItemValueDate'
                    }]
                  },
                  {
                    width: contentWidth - 120,
                    stack: [{ text: '0', style: 'holidayValue' }]
                  }
                ],
                margin: [this.converPx(16), holidayCounter === 1 ? 0 : 4, 16, this.converPx(11)]
              }
            ],
            margin: [0, this.converPx(16), 0, this.converPx(16)]
          },
          ...(isLastHolidayBlock && nextIsPayment ? [{
            canvas: [{
              type: 'line',
              x1: this.converPx(16),
              y1: 0,
              x2: 515 - 16 - 16,
              y2: 0,
              lineWidth: 1,
              lineColor: '#f4f4f4'
            }],
            margin: [0, 0, 0, this.converPx(12)]
          }] : [])
        ],
        unbreakable: true,
        margin: [0, 0, 0, 0]
      });

    } else {
      // === –û–ë–´–ß–ù–´–ô –ü–õ–ê–¢–Å–ñ –ò–õ–ò –î–û–°–†–û–ß–ù–û–ï ===
      if (item.prepayments && item.prepayments.length > 0) {
        // === –î–û–°–†–û–ß–ù–û–ï –ü–û–ì–ê–®–ï–ù–ò–ï ===
        item.prepayments.forEach((product, i) => {
          if (String(product.amount).toLowerCase().includes('e')) return;
          blocks.push(this.createEarlyRepaymentBlock(product));
        });

        // üîë –ü–û–°–õ–ï –î–û–°–†–û–ß–ù–û–ì–û:
        if (nextIsPayment) {
          // –î–æ—Å—Ä–æ—á–Ω–æ–µ ‚Üí –ü–ª–∞—Ç—ë–∂: –ª–∏–Ω–∏—è —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ 12px/12px
          blocks.push({
            canvas: [{
              type: 'line',
              x1: this.converPx(16),
              y1: 0,
              x2: 515 - 16 - 16,
              y2: 0,
              lineWidth: 1,
              lineColor: '#f4f4f4'
            }],
            margin: [0, this.converPx(12), 0, this.converPx(12)]
          });
        } else if (nextIsEarly || nextIsHoliday) {
          // –î–æ—Å—Ä–æ—á–Ω–æ–µ ‚Üí –î–æ—Å—Ä–æ—á–Ω–æ–µ / –ö–∞–Ω–∏–∫—É–ª—ã: –ø—Ä–æ—Å—Ç–æ –æ—Ç—Å—Ç—É–ø 12px
          blocks.push({ text: '', margin: [0, this.converPx(12), 0, 0] });
        }

      } else {
        // === –û–ë–´–ß–ù–´–ô –ü–õ–ê–¢–Å–ñ ===
        blocks.push(this.createStandardPaymentBlock(item));

        // üîë –ü–û–°–õ–ï –ü–õ–ê–¢–ï–ñ–ê:
        if (hasNextItem && !nextIsHoliday) {
          // –ü–ª–∞—Ç—ë–∂ ‚Üí (–ü–ª–∞—Ç—ë–∂ –∏–ª–∏ –î–æ—Å—Ä–æ—á–Ω–æ–µ): –ª–∏–Ω–∏—è —Å 12px/12px
          blocks.push({
            canvas: [{
              type: 'line',
              x1: this.converPx(16),
              y1: 0,
              x2: 515 - 16 - 16,
              y2: 0,
              lineWidth: 1,
              lineColor: '#f4f4f4'
            }],
            margin: [0, this.converPx(12), 0, this.converPx(12)]
          });
        }
      }
    }
  });

  return { stack: blocks };
},
