–î–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –≤–∏–¥–µ–æ:
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-vkvideo-ru/
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-rutube-ru/

–í–∏–¥–µ–æ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏:

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/sberezhenie-sredstv-v-krizisnoy-situatsii/

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/keshbek-dlya-zhizni-kak-vernut-potrachennye-dengi/



let activeDropdown = null;
let activeTrigger = null;
let scrollRAF = null;

function initShareBlocks() {
  const triggers = document.querySelectorAll('.js--soc-list-share:not([data-initialized])');
  triggers.forEach(trigger => {
    trigger.dataset.initialized = 'true';
    trigger.addEventListener('click', handleShareClick);
  });
}

function handleShareClick(e) {
  e.preventDefault();
  const trigger = e.currentTarget;
  const wrapper = trigger.closest('.js--soc-list-wrapper-share');
  if (!wrapper) return;

  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π dropdown
  if (activeDropdown) {
    cleanupDropdown();
  }

  let dropdown = wrapper.querySelector('.soc-list__share');
  if (!dropdown) {
    dropdown = createShareDropdown(wrapper);
    wrapper.appendChild(dropdown);
  }

  dropdown.style.display = 'block';
  // –î–æ–±–∞–≤–ª—è–µ–º opacity –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
  dropdown.style.opacity = '0';
  dropdown.style.transition = 'opacity 0.2s ease, transform 0.2s ease';

  requestAnimationFrame(() => {
    positionDropdown(trigger, dropdown);
    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
    dropdown.style.opacity = '1';
  });

  // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—Ä–∏–ª–∏–ø–∞–Ω–∏–µ
  activeDropdown = dropdown;
  activeTrigger = trigger;
  window.addEventListener('scroll', onScroll, { passive: true });
}

function onScroll() {
  if (scrollRAF) return;
  scrollRAF = requestAnimationFrame(() => {
    if (activeDropdown && activeTrigger) {
      positionDropdown(activeTrigger, activeDropdown);
    }
    scrollRAF = null;
  });
}

function positionDropdown(trigger, dropdown) {
  const rect = trigger.getBoundingClientRect();
  const top = rect.top + rect.height + 10; // –æ—Ç—Å—Ç—É–ø 10px
  const left = rect.left;

  // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ transform (–ª—É—á—à–µ, —á–µ–º top/left)
  dropdown.style.transform = `translate(${Math.round(left)}px, ${Math.round(top)}px)`;
}

function cleanupDropdown() {
  if (activeDropdown) {
    // –ü–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º
    activeDropdown.style.opacity = '0';
    setTimeout(() => {
      if (activeDropdown) {
        activeDropdown.style.display = 'none';
        activeDropdown.style.transform = '';
      }
    }, 200);
  }
  activeDropdown = null;
  activeTrigger = null;
  window.removeEventListener('scroll', onScroll);
}

function createShareDropdown(wrapper) {
  // === –ü–∞—Ä—Å–∏–Ω–≥ data-services ===
  const servicesStr = (wrapper.dataset.services || '').trim();
  let services = [];

  if (servicesStr) {
    try {
      services = JSON.parse(servicesStr);
    } catch (_) {
      let cleaned = servicesStr.trim();
      if (cleaned.startsWith('[') && cleaned.endsWith(']')) {
        cleaned = cleaned.slice(1, -1).trim();
      }
      services = cleaned.split(',').map(s => s.trim()).filter(Boolean);
    }
  }

  if (!Array.isArray(services)) services = [];

  // === –î–∞–Ω–Ω—ã–µ –¥–ª—è —à–∞—Ä–∏–Ω–≥–∞ ===
  const rawUrl = wrapper.dataset.url || location.href;
  const rawText = wrapper.dataset.text || document.title;
  const rawImage = wrapper.dataset.image || '';

  const url = encodeURIComponent(rawUrl);
  const text = encodeURIComponent(rawText);
  const imageUrl = encodeURIComponent(rawImage);

  // === –°–æ–∑–¥–∞–Ω–∏–µ DOM ===
  const dropdown = document.createElement('div');
  dropdown.className = 'soc-list__share';
  dropdown.style.display = 'none';
  dropdown.style.position = 'fixed';
  dropdown.style.top = '0';
  dropdown.style.left = '0';
  dropdown.style.opacity = '0';
  dropdown.style.pointerEvents = 'none'; // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–ª–∏–∫–∏ –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
  dropdown.style.transition = 'opacity 0.2s ease, transform 0.2s ease';

  const ul = document.createElement('ul');

  const serviceTitles = {
    whatsapp: 'WhatsApp',
    telegram: 'Telegram',
    vkontakte: '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ',
    odnoklassniki: '–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏',
  };

  services.forEach(service => {
    const title = serviceTitles[service];
    if (!title) return;

    const li = document.createElement('li');
    const a = document.createElement('a');
    const icon = document.createElement('div');
    const span = document.createElement('span');

    icon.className = `soc-list__share-icon ${service}-icon-share`;
    span.className = 'soc-list__share-title';
    span.textContent = title;

    a.href = getShareUrl(service, { url, text, imageUrl });
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.appendChild(icon);
    a.appendChild(span);

    li.appendChild(a);
    ul.appendChild(li);
  });

  // === –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ ===
  const copyLi = document.createElement('li');
  const copyDiv = document.createElement('div');
  copyDiv.className = 'soc-list__copy-link';
  copyDiv.dataset.copyLink = '';

  const copyIcon = document.createElement('div');
  copyIcon.className = 'soc-list__share-icon copy-link';

  const copyTitle = document.createElement('span');
  copyTitle.className = 'soc-list__share-title';
  copyTitle.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É';

  copyDiv.appendChild(copyIcon);
  copyDiv.appendChild(copyTitle);
  copyLi.appendChild(copyDiv);
  ul.appendChild(copyLi);

  dropdown.appendChild(ul);

  // === –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è ===
  copyDiv.addEventListener('click', function (ev) {
    ev.stopPropagation();

    const titleEl = copyTitle;
    if (!titleEl) return;

    const copy = () => {
      if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
        return navigator.clipboard.writeText(rawUrl);
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = rawUrl;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(textarea);
        return ok ? Promise.resolve() : Promise.reject(new Error('copy failed'));
      }
    };

    copy()
      .then(() => {
        // ‚úÖ –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∏ –ó–ê–ö–†–´–í–ê–ï–ú –æ–∫–Ω–æ
        titleEl.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
        // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
        setTimeout(() => {
          cleanupDropdown();
        }, 500); // 0.5—Å ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å
      })
      .catch(err => {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É:', err);
        titleEl.textContent = '–û—à–∏–±–∫–∞';
        setTimeout(() => {
          titleEl.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É';
        }, 1500);
      });
  });

  // === –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –ª—é–±–æ–π –ø—É–Ω–∫—Ç (—Å–æ—Ü—Å–µ—Ç–∏) ===
  dropdown.addEventListener('click', (ev) => {
    if (ev.target.closest('a')) {
      cleanupDropdown();
    }
  });

  // === –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ ===
  const onClickOutside = (ev) => {
    if (
      activeDropdown === dropdown &&
      !dropdown.contains(ev.target) &&
      !ev.target.closest('.js--soc-list-share')
    ) {
      cleanupDropdown();
    }
  };
  document.addEventListener('click', onClickOutside);

  // –û—Ç–ø–∏—Å–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ dropdown (–Ω–∞ –≤—Å—è–∫–∏–π)
  dropdown._cleanup = () => {
    document.removeEventListener('click', onClickOutside);
  };

  return dropdown;
}

function getShareUrl(service, { url, text, imageUrl }) {
  // üîî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ URL (–±—ã–ª–∏ `url=  ${url}`)
  switch (service) {
    case 'whatsapp':
      return `https://wa.me/?text=${text}%20${url}`;
    case 'telegram':
      return `https://t.me/share/url?url=${url}&text=${text}`;
    case 'vkontakte':
      return `https://vk.com/share.php?url=${url}&title=${text}&image=${imageUrl}&noparse=true`;
    case 'odnoklassniki':
      return `https://connect.ok.ru/offer?url=${url}&title=${text}&imageUrl=${imageUrl}`;
    default:
      return '#';
  }
}

export default function shareSocList() {
  initShareBlocks();
}

.soc-list__share {
  position: fixed;
  top: 0;
  left: 0;
  opacity: 0;
  pointer-events: none; // –≤–∞–∂–Ω–æ ‚Äî –ø–æ–∫–∞ –Ω–µ –ø–æ—è–≤–∏–ª—Å—è
  transform: translate(0, 0);
  transition: opacity 0.2s ease, transform 0.2s ease;

  &.active {
    opacity: 1;
    pointer-events: auto;
  }

  ul {
    margin: 0;
    padding: 0;
    list-style: none;
  }

  li {
    margin: 2px 0;
  }
}









