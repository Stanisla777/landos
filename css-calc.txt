// Показ тултипа
function showTooltip(trigger, content) {
  // Закрываю предыдущий тултип, если он есть
  if (activeTooltip) {
    hideTooltip(activeTooltip);
  }

  // Создаю новый тултип с контентом из data-content-text блока на который навели
  // Передаю триггер для проверки класса aside-location
  const tooltip = createTooltip(content, trigger);
  const container = ensureTooltipContainer();
  container.appendChild(tooltip);

  // Определяю, какую функцию позиционирования использовать
  const focusParent = trigger.closest('.js--focus-on-parent');
  if (focusParent) {
    // Позиционируем относительно родителя
    positionTooltipRelativeToParent(trigger, tooltip);
  } else {
    // Позиционируем относительно экрана
    positionTooltip(trigger, tooltip);
  }

  // Показываю с анимацией
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      // Добавляем класс контейнеру
      container.classList.add('active');
      
      // Анимация тултипа
      tooltip.style.opacity = '1';
      tooltip.style.pointerEvents = 'auto';
      tooltip.classList.add('active');
    });
  });

  // Сохраняю ссылки на текущий тултип
  activeTooltip = tooltip;
  activeTrigger = trigger;

  // Для мобильных добавляю блокировку скролла
  if (isMobileDevice()) {
    addClassBody();
  }
}

---------------------------------

// Скрытие тултипа
function hideTooltip(tooltip) {
  if (!tooltip) return;

  // Отменяю таймер закрытия
  if (tooltipCloseTimer) {
    clearTimeout(tooltipCloseTimer);
    tooltipCloseTimer = null;
  }

  tooltip.style.pointerEvents = 'none';
  tooltip.style.opacity = '0';
  tooltip.classList.remove('active');

  setTimeout(() => {
    if (tooltip.parentNode) {
      tooltip.parentNode.removeChild(tooltip);
      
      // Удаляем класс контейнера, если больше нет тултипов
      if (!tooltipContainer.querySelector('.content-note__text-new')) {
        tooltipContainer.classList.remove('active');
      }
    }

    // Разблокирую скролл для мобильных
    if (isMobileDevice()) {
      removeClassBody();
    }
  }, 200);

  activeTooltip = null;
  activeTrigger = null;
}

----------------------------------------

// Позиционирование тултипа относительно экрана
function positionTooltip(trigger, tooltip) {
  const rect = trigger.getBoundingClientRect();
  const viewportWidth = window.innerWidth;
  const viewportHeight = window.innerHeight;

  const isNarrow = window.matchMedia('(max-width: 480px)').matches;

  // Для мобильных телефонов использую мобильный вид
  if (isMobilePhone() || isNarrow) {
    // Начальное состояние для анимации снизу вверх
    tooltip.style.transform = 'translate(-50%, 101%)';
    tooltip.style.bottom = '0';
    tooltip.style.left = '50%';
    tooltip.style.top = 'unset';
    tooltip.style.right = 'unset';
    tooltip.classList.add('mobile-tooltip');
    return;
  }

  // ... остальной код без изменений ...
}

-------------------------------------

// Позиционирование тултипа относительно родителя с классом .js--focus-on-parent
function positionTooltipRelativeToParent(trigger, tooltip) {
  const rect = trigger.getBoundingClientRect();
  const viewportWidth = window.innerWidth;
  const viewportHeight = window.innerHeight;

  const isNarrow = window.matchMedia('(max-width: 480px)').matches;

  // Для мобильных телефонов использую мобильный вид
  if (isMobilePhone() || isNarrow) {
    // Начальное состояние для анимации снизу вверх
    tooltip.style.transform = 'translate(-50%, 101%)';
    tooltip.style.bottom = '0';
    tooltip.style.left = '50%';
    tooltip.style.top = 'unset';
    tooltip.style.right = 'unset';
    tooltip.classList.add('mobile-tooltip');
    return;
  }

  // ... остальной код без изменений ...
}

-------------------------------------
// Создаю общий контейнер один раз
function ensureTooltipContainer() {
  if (!tooltipContainer) {
    tooltipContainer = document.createElement('div');
    tooltipContainer.className = 'tooltip-popup-container';
    Object.assign(tooltipContainer.style, {
      position: 'fixed',
      top: '0',
      left: '0',
      width: '100%',
      height: '100%',
      pointerEvents: 'none',
      zIndex: '2147483646',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
    });
    document.body.appendChild(tooltipContainer);
  }
  
  // Добавляем/удаляем класс mobile-tooltip в зависимости от устройства
  const isNarrow = window.matchMedia('(max-width: 480px)').matches;
  if (isMobilePhone() || isNarrow) {
    tooltipContainer.classList.add('mobile-tooltip');
    // Для мобильных убираем центрирование контейнера
    tooltipContainer.style.alignItems = 'flex-end';
    tooltipContainer.style.justifyContent = 'center';
  } else {
    tooltipContainer.classList.remove('mobile-tooltip');
    tooltipContainer.style.alignItems = 'center';
    tooltipContainer.style.justifyContent = 'center';
  }
  
  return tooltipContainer;
}
-------------------------------------------------
// Обработчик изменения размера окна
function handleResize() {
  // Обновляем стили контейнера
  if (tooltipContainer) {
    const isNarrow = window.matchMedia('(max-width: 480px)').matches;
    if (isMobilePhone() || isNarrow) {
      tooltipContainer.style.alignItems = 'flex-end';
      tooltipContainer.style.justifyContent = 'center';
    } else {
      tooltipContainer.style.alignItems = 'center';
      tooltipContainer.style.justifyContent = 'center';
    }
  }

  if (activeTooltip && activeTrigger) {
    const focusParent = activeTrigger.closest('.js--focus-on-parent');
    if (focusParent) {
      positionTooltipRelativeToParent(activeTrigger, activeTooltip);
    } else {
      positionTooltip(activeTrigger, activeTooltip);
    }
  }

  // Для мобильных устройств закрываю тултип при изменении ориентации
  const isNarrow = window.matchMedia('(max-width: 480px)').matches;

  if (isMobilePhone() && !isNarrow && activeTooltip) {
    hideTooltip(activeTooltip);
  }
}

--------------------------------------------------

// Контейнер тултипа
.tooltip-popup-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2147483646;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: opacity 0.2s ease;

  &.active {
    pointer-events: auto;
  }

  // Для мобильных телефонов
  &.mobile-tooltip {
    align-items: flex-end;
    justify-content: center;
  }
}

// Тултип
.content-note__text-new {
  position: absolute;
  background: #fff;
  border-radius: 8px;
  padding: 16px 20px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  max-width: 320px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
  font-size: 14px;
  line-height: 1.4;
  color: #333;

  &.active {
    opacity: 1;
    pointer-events: auto;
  }

  // Мобильный вид
  &.mobile-tooltip {
    position: fixed;
    padding: 24px;
    padding-top: 16px;
    bottom: 0;
    top: unset !important;
    left: 50%;
    transform: translate(-50%, 101%) !important;
    height: max-content;
    width: 101%;
    border-top-left-radius: 16px;
    border-top-right-radius: 16px;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    max-height: 80vh;
    overflow-y: auto;
    background-color: #fff;
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);

    &.active {
      transform: translate(-50%, 0) !important;
    }
  }

  // ... остальные стили без изменений ...
}
