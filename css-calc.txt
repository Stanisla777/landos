js –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–æ–¥–∞–ª—å–≥–æ–≥–æ –º–µ–Ω—é

/* eslint-disable */
import dropDown from '../dropDown';
import AddClassBody from './disallow-body-scrolling';
import RemoveClassBody from './allow-body-scrolling';

function dropDownSubMenu() {
  const menuHeaderBtn = document.querySelectorAll('.js--mobile-menu-btn')
  for (let item of menuHeaderBtn) {
    item.onclick = (el) => {
      if (!el.target.classList.contains('js--mobile-menu-link')) {
        dropDown(el.target,0)
      }
    }
  }
}

function callMobileMenu() {
  const btn = document.querySelector('.js--header-burger');
  const mobileMenu = document.querySelector('.js--mobile-menu');
  const containerYandexSearch = document.querySelector('.js--yandex-search');
  if (btn && btn.closest('.js--page-content')) {
    btn.onclick = (el) => {
      const header = btn.closest('.js--page-content').querySelector('.header');
      if (header) {
        header.classList.toggle('z-ind');
      }

      if (containerYandexSearch) {
        if (containerYandexSearch.classList.contains('active') && document.body.classList.contains('body-modal') && document.body.classList.contains('body-additional-class')) {
          AddClassBody();
        }
        else if (!containerYandexSearch.classList.contains('active')
          && !document.body.classList.contains('body-modal')
          && !document.body.classList.contains('body-additional-class')) {
          AddClassBody();
        }
        else if (!containerYandexSearch.classList.contains('active')
          && document.body.classList.contains('body-modal')
          && document.body.classList.contains('body-additional-class')) {
          RemoveClassBody();
        }
      }
      else {
        if (document.body.classList.contains('body-modal') && document.body.classList.contains('body-additional-class')) {
          RemoveClassBody()
        }


        else if (!document.body.classList.contains('body-modal') && !document.body.classList.contains('body-additional-class')){
          AddClassBody();
        }
      }

      // document.body.classList.toggle('body-modal');
      // document.body.classList.toggle('body-additional-class');
      // btn.closest('.header').classList.toggle('not-border')
      // btn.classList.toggle('open');
      if (btn.classList.contains('open')) {
        btn.classList.remove('open')
      } else {
        btn.classList.add('open')
      }

      if (mobileMenu) {
        // mobileMenu.classList.toggle('active');
        if (mobileMenu.classList.contains('active')) {
          mobileMenu.classList.remove('active')
          document.body.classList.remove('non-scroll-for-body')
        } else {
          mobileMenu.classList.add('active')
          document.body.classList.add('non-scroll-for-body')
        }
      }


    };
  }
}
//–ß—Ç–æ–±—ã –±—ã–ª–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–æ—â–µ

// function resizeWindowCloseMobileMenu(){
//   const containerYandexSearch = document.querySelector('.js--yandex-search');
//   const btn = document.querySelector('.js--header-burger');
//   const mobileMenu = document.querySelector('.js--mobile-menu');
//   const header = btn.closest('.js--page-content').querySelector('.header');
//   window.addEventListener('resize', ()=>{
//
//     if (window.innerWidth > 1225) {
//       if (mobileMenu && mobileMenu.classList.contains('active')) {
//         mobileMenu.classList.remove('active')
//       }
//       if (btn && btn.classList.contains('open')) {
//         btn.classList.remove('open')
//       }
//       if (header && header.classList.contains('z-ind')){
//         header.classList.remove('z-ind');
//       }
//       if (mobileMenu) {
//         const menu_accordeon = mobileMenu.querySelectorAll('.header__mobile-menu-item.js-accordion-parent')
//         for (let item of menu_accordeon) {
//           item.classList.remove('active')
//           if (item.querySelector('.js-accordion-body')) {
//             item.querySelector('.js-accordion-body').setAttribute('style', `max-height:0;`)
//           }
//         }
//       }
//
//
//       if ((containerYandexSearch&&!containerYandexSearch.classList.contains('active'))
//         && document.body.classList.contains('body-modal')
//         && document.body.classList.contains('body-additional-class')) {
//         RemoveClassBody();
//       }
//       if (!containerYandexSearch
//         && document.body.classList.contains('body-modal')
//         && document.body.classList.contains('body-additional-class')
//         && !document.body.classList.contains('body-modal-not-remove')) {
//         RemoveClassBody();
//       }
//     }
//   });
// }

// –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ —Å–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥—Ç–∫–æ–π

// function resizeWindowCloseMobileMenu(){
//   let isMobileMenuOpen = false;
//   const btn = document.querySelector('.js--header-burger');
//   const mobileMenu = document.querySelector('.js--mobile-menu');
//   if (!btn || !mobileMenu) return;
//
//   let header = null;
//   const pageContent = btn.closest && btn.closest('.js--page-content');
//   if (pageContent) {
//     header = pageContent.querySelector('.header');
//   }
//
//   const containerYandexSearch = document.querySelector('.js--yandex-search');
//
//   // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—é (—Å –Ω–µ–±–æ–ª—å—à–∏–º debounce –¥–ª—è iOS) ===
//   let updateDebounceId;
//   const updateMenuState = () => {
//     clearTimeout(updateDebounceId);
//     updateDebounceId = setTimeout(() => {
//       isMobileMenuOpen = mobileMenu.classList.contains('active');
//     }, 10); // 10ms ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ iOS
//   };
//
//   updateMenuState(); // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
//
//   const observer = new MutationObserver(updateMenuState);
//   observer.observe(mobileMenu, { attributes: true, attributeFilter: ['class'] });
//   observer.observe(btn, { attributes: true, attributeFilter: ['class'] });
//
//   // === –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é ‚Äî —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–µ—Ä—Å–∏—è ===
//   const closeMobileMenuIfOpen = () => {
//     // –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –Ω–∞ —Å–ª—É—á–∞–π race condition –≤ iOS
//     const currentlyOpen = mobileMenu.classList.contains('active');
//     if (!isMobileMenuOpen && !currentlyOpen) return;
//
//     mobileMenu.classList.remove('active');
//     btn.classList.remove('open');
//     if (header && header.classList.contains('z-ind')) {
//       header.classList.remove('z-ind');
//     }
//
//     // –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã
//     const accordions = mobileMenu.querySelectorAll('.header__mobile-menu-item.js-accordion-parent');
//     for (let i = 0; i < accordions.length; i++) {
//       const item = accordions[i];
//       item.classList.remove('active');
//       const body = item.querySelector('.js-accordion-body');
//       if (body) body.style.maxHeight = '0';
//     }
//
//     // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ —Å body
//     const body = document.body;
//     const hasModalClasses = body.classList.contains('body-modal') && body.classList.contains('body-additional-class');
//     if (hasModalClasses) {
//       const shouldRemove =
//         (containerYandexSearch && !containerYandexSearch.classList.contains('active')) ||
//         (!containerYandexSearch && !body.classList.contains('body-modal-not-remove'));
//
//       if (shouldRemove) {
//         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏)
//         if (typeof RemoveClassBody === 'function') {
//           RemoveClassBody();
//         } else if (typeof window.RemoveClassBody === 'function') {
//           window.RemoveClassBody();
//         }
//       }
//     }
//
//     isMobileMenuOpen = false;
//   };
//
//   // === matchMedia ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –±–µ–∑ –ø–æ–ª–∏—Ñ–∏–ª–ª–æ–≤ –Ω—É–∂–Ω–æ ===
//   const mediaQuery = window.matchMedia('(min-width: 1225px)');
//
//   const handleMediaChange = function (e) {
//     if (e.matches) {
//       closeMobileMenuIfOpen();
//     }
//   };
//
//   // –°–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤, –≥–¥–µ addEventListener –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —É MediaQueryList)
//   if (mediaQuery.addEventListener) {
//     mediaQuery.addEventListener('change', handleMediaChange);
//   } else if (mediaQuery.addListener) {
//     // —É—Å—Ç–∞—Ä–µ–≤—à–∏–π API (IE10, –æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–µ Safari) ‚Äî –Ω–æ –Ω–∞ iOS 13+ –Ω–µ –Ω—É–∂–µ–Ω
//     mediaQuery.addListener(handleMediaChange);
//   }
//
//   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
//   if (mediaQuery.matches) {
//     closeMobileMenuIfOpen();
//   }
// }

function resizeWindowCloseMobileMenu(){
  console.log('–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è');
  let isMobileMenuOpen = false;
  const btn = document.querySelector('.js--header-burger');
  const mobileMenu = document.querySelector('.js--mobile-menu');
  if (!btn || !mobileMenu) return;

  // === –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ header (–±–µ–∑ optional chaining) ===
  let header = null;
  const pageContent = btn.closest && btn.closest('.js--page-content');
  if (pageContent) {
    header = pageContent.querySelector('.header');
  }

  const containerYandexSearch = document.querySelector('.js--yandex-search');

  // === –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–Ω—é —Å debounce (–¥–ª—è iOS-—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏) ===
  let updateDebounceId;
  const updateMenuState = () => {
    clearTimeout(updateDebounceId);
    updateDebounceId = setTimeout(() => {
      isMobileMenuOpen = mobileMenu.classList.contains('active');
    }, 10);
  };

  updateMenuState();
  const observer = new MutationObserver(updateMenuState);
  observer.observe(mobileMenu, { attributes: true, attributeFilter: ['class'] });
  observer.observe(btn, { attributes: true, attributeFilter: ['class'] });

  // === –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è ‚Äî —Å –≤–∞—à–∏–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ ===

  // const closeMobileMenuIfOpen = () => {
  //   const body = document.body;
  //
  //   console.log('–í—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è');
  //
  //   // üîπ –£—Å–ª–æ–≤–∏–µ –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞: –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ —Å—Ç–æ–∏—Ç 'body-modal-not-remove-else'
  //   if (
  //     !isMobileMenuOpen ||
  //     !mobileMenu.classList.contains('active') ||
  //     body.classList.contains('body-modal-not-remove-else')
  //   ) {
  //     return;
  //   }
  //
  //   // üîπ –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –∏ –∫–Ω–æ–ø–∫—É
  //   mobileMenu.classList.remove('active');
  //   if (btn.classList.contains('open')) {
  //     btn.classList.remove('open');
  //   }
  //   if (header && header.classList.contains('z-ind')) {
  //     header.classList.remove('z-ind');
  //   }
  //
  //   // üîπ –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã (–≤–∞—à–∞ –ª–æ–≥–∏–∫–∞)
  //   const accordions = mobileMenu.querySelectorAll('.header__mobile-menu-item.js-accordion-parent');
  //   for (let i = 0; i < accordions.length; i++) {
  //     const item = accordions[i];
  //     item.classList.remove('active');
  //     const bodyEl = item.querySelector('.js-accordion-body');
  //     if (bodyEl) {
  //       bodyEl.setAttribute('style', 'max-height:0;');
  //     }
  //   }
  //
  //   // üîπ –£—Å–ª–æ–≤–∏—è –¥–ª—è RemoveClassBody ‚Äî –∫–∞–∫ —É –≤–∞—Å (–¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞)
  //   const hasModalClasses = body.classList.contains('body-modal') && body.classList.contains('body-additional-class');
  //   if (hasModalClasses) {
  //     // –í–∞—Ä–∏–∞–Ω—Ç 1: –µ—Å—Ç—å containerYandexSearch, –Ω–æ –æ–Ω –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω
  //     if (
  //       containerYandexSearch &&
  //       !containerYandexSearch.classList.contains('active')
  //     ) {
  //       safeCallRemoveClassBody();
  //     }
  //     // –í–∞—Ä–∏–∞–Ω—Ç 2: containerYandexSearch –≤–æ–æ–±—â–µ –Ω–µ—Ç
  //     else if (!containerYandexSearch) {
  //       safeCallRemoveClassBody();
  //     }
  //   }
  //
  //   isMobileMenuOpen = false;
  // };

  const closeMobileMenuIfOpen = () => {
    const body = document.body;

    // üî∏ –£–ë–ò–†–ê–ï–ú —É—Å–ª–æ–≤–∏–µ —Å 'body-modal-not-remove-else'!
    if (!isMobileMenuOpen || !mobileMenu.classList.contains('active')) {
      return;
    }

    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é
    mobileMenu.classList.remove('active');
    btn.classList.remove('open');
    if (header && header.classList.contains('z-ind')) {
      header.classList.remove('z-ind');
    }

    // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã
    const accordions = mobileMenu.querySelectorAll('.header__mobile-menu-item.js-accordion-parent');
    accordions.forEach(item => {
      item.classList.remove('active');
      const bodyEl = item.querySelector('.js-accordion-body');
      if (bodyEl) bodyEl.style.maxHeight = '0';
    });

    // üî∏ –í–°–ï–ì–î–ê —É–±–∏—Ä–∞–µ–º non-scroll-for-body –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø
    document.body.classList.remove('non-scroll-for-body');

    // üî∏ –ò –ù–ï –≤—ã–∑—ã–≤–∞–µ–º RemoveClassBody –∑–¥–µ—Å—å ‚Äî —ç—Ç–∏–º –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è closeModal
    isMobileMenuOpen = false;
  };

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—ã–∑–æ–≤
  function safeCallRemoveClassBody() {
    if (typeof RemoveClassBody === 'function') {

      RemoveClassBody();
      document.body.classList.remove('non-scroll-for-body')
    } else if (typeof window.RemoveClassBody === 'function') {
      window.RemoveClassBody();
      document.body.classList.remove('non-scroll-for-body')
    }

  }

  // === –ü–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ matchMedia (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ + iOS-safe) ===
  const mediaQuery = window.matchMedia('(min-width: 1225px)');

  const handleMediaChange = (e) => {
    if (e.matches) {
      closeMobileMenuIfOpen();
    }
  };

  // –°–æ–≤–º–µ—Å—Ç–∏–º–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
  if (mediaQuery.addEventListener) {
    mediaQuery.addEventListener('change', handleMediaChange);
  } else if (mediaQuery.addListener) {
    mediaQuery.addListener(handleMediaChange); // legacy, –Ω–æ –¥–ª—è –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  if (mediaQuery.matches) {
    closeMobileMenuIfOpen();
  }
}

export default function headerMenu() {
  dropDownSubMenu();
  callMobileMenu();
  resizeWindowCloseMobileMenu();
}
js –¥–ª—è –º–æ–¥–∞–ª–∫–∏

/* eslint-disable */
import AddClassBody from './redesign-site/disallow-body-scrolling';
import RemoveClassBody from './redesign-site/allow-body-scrolling';

// –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
let isInitialized = false;

export function closeModal(id) {
  const modalWindow = document.getElementById(id);
  if (!modalWindow) return;

  if (modalWindow.querySelector('.js--stories-body-video video')) {
    modalWindow.querySelector('.js--stories-body-video video').pause();
  }

  const promice = new Promise((resolve) => {
    if (modalWindow.classList.contains('open')) {
      if (modalWindow.querySelector('.select-list__selection-window')) {
        modalWindow.querySelector('.select-list__selection-window').classList.remove('opacity');
        setTimeout(() => {
          modalWindow.classList.remove('open');
        }, 200);
      } else {
        modalWindow.classList.remove('open');
      }
    } else if (modalWindow.classList.contains('show')) {
      modalWindow.classList.remove('show');
    }

    document.body.classList.remove('modal-opened', 'body-modal-not-remove', 'body-modal-not-remove-else');

    // if (!document.body.classList.contains('non-scroll-for-body') && document.body.classList.contains('body-additional-class')) {
    //   RemoveClassBody();
    // }

    if (!document.body.classList.contains('non-scroll-for-body')) {
      RemoveClassBody();
    }

    resolve();
  }).then(() =>
    new Promise((resolve) => {
      setTimeout(() => {
        // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —É–±–∏—Ä–∞—Ç—å body-modal –ø–æ–∑–∂–µ
        // document.body.classList.remove('body-modal');
        resolve();
      }, 500);
    })
  );

  return promice;
}

export function modals() {
  if (isInitialized) return;
  isInitialized = true;

  // === 1. –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ ‚Äî –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ===
  document.addEventListener('click', (e) => {
    const opener = e.target.closest('.js--modal-opener[data-modal]');
    if (!opener) return;

    e.preventDefault();

    const modalSelector = opener.dataset.modal;
    const modal = document.querySelector(modalSelector);
    if (!modal) {
      return;
    }

    // –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
    if (opener.dataset.program) {
      const input = document.querySelector('label.prog input');
      if (input) input.value = opener.dataset.program;
    }

    // –û—Ç–∫—Ä—ã—Ç–∏–µ
    modal.classList.add('open');

    // –ê–Ω–∏–º–∞—Ü–∏—è select-list
    const selectWindow = modal.querySelector('.select-list__selection-window');
    if (selectWindow) {
      setTimeout(() => {
        selectWindow.classList.add('opacity');
      }, 400);
    }

    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞
    document.body.classList.add(
      'modal-opened',
      'body-modal-not-remove-else',
      'body-modal-not-remove'
    );
    AddClassBody();
  });

  // === 2. –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ ‚Äî –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ===
  document.addEventListener('click', (e) => {
    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    const closer = e.target.closest('.js--modal-closer');
    if (closer) {
      const modal = closer.closest('.modal');
      if (modal) closeModal(modal.id);
      return;
    }

    // –ö–ª–∏–∫ –ø–æ —Ñ–æ–Ω—É (–≤–Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ)
    const modal = e.target.closest('.modal');
    if (modal && !e.target.closest('.js--modal, .modal__wrapper')) {
      closeModal(modal.id);
    }
  });
}

// –ï—Å–ª–∏ catalogModal —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∏–Ω–∞–º–∏–∫–æ–π ‚Äî –µ–≥–æ —Ç–æ–∂–µ –Ω—É–∂–Ω–æ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å
export function catalogModal() {
  // –ü—Ä–æ—Å—Ç–æ –¥–µ–ª–µ–≥–∏—Ä—É–µ–º –∫–ª–∏–∫ –Ω–∞ –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç
  document.addEventListener('click', (e) => {
    const opener = e.target.closest('.js--ct-modal-opener');
    if (!opener) return;

    const program = opener.getAttribute('data-program');
    const input = document.querySelector('label.prog input');
    if (program && input) {
      input.value = program;
    }

    const modal = document.querySelector('#modalcall');
    if (modal) {
      modal.classList.add('open');
      document.body.classList.add('modal-opened');
    }
  });
}
