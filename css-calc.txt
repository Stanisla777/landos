–î–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –≤–∏–¥–µ–æ:
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-vkvideo-ru/
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-rutube-ru/

–í–∏–¥–µ–æ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏:

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/sberezhenie-sredstv-v-krizisnoy-situatsii/

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/keshbek-dlya-zhizni-kak-vernut-potrachennye-dengi/




 .card-video__icon-play {
    width: 96px;
    height: 96px;
    background-color: rgba(0, 0, 0, .5);
    border-radius: 50%;
    transition: background .2s, transform .2s;
    transition-timing-function: ease-out;
    will-change: background, transform;
    display: flex;
    align-items: center;
    justify-content: center;
}

.separate-video .card-video__icon-play:before {
    content: "";
    display: block;
    width: 48px;
    height: 48px;
    background-position: 50%;
    background-repeat: no-repeat;
    background-size: contain;
    background-image: url(data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' clip-rule='evenodd' width='48' height='48' fill='%23fff' style='width:48px;height:48px'%3E%3Cpath d='M14.4 8.76l24.02 13.85a1.6 1.6 0 010 2.78L14.4 39.24a1.6 1.6 0 01-2.4-1.39v-27.7a1.6 1.6 0 012.4-1.39'/%3E%3C/svg%3E);
}

.card-video__prev:hover .card-video__icon-play {
    background-color: rgba(0, 0, 0, .6);
    transform: translate(-50%, -50%) scale(1.15);
}

<div class="card-video__icon-play"></div>


const beforeLoadEl = container.querySelector('.before-load');
if (beforeLoadEl) {
  beforeLoadEl.style.display = 'none';
}



videos[i].querySelector('.card-video__prev').onclick = function () {
  const container = videos[i];
  const type_video = container.getAttribute('for-category');

  // –£–±–∏—Ä–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
  var picture = container.querySelector('picture');
  var playIcon = container.querySelector('.card-video__icon-play');
  if (picture) picture.style.display = 'none';
  if (playIcon) playIcon.style.display = 'none';

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  if (type_video === 'file') {
    var videoEl = container.querySelector('video');
    if (videoEl) {
      videoEl.style.display = 'block';
      var beforeLoadEl = container.querySelector('.before-load');
      if (beforeLoadEl) beforeLoadEl.style.display = 'none';

      videoEl.muted = true;
      videoEl.play().catch(function (err) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–µ–æ:', err);
      });
    }
    return;
  }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  // iframe (YouTube / VK / Rutube / –¥—Ä.)
  // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
  var iframe = container.querySelector('iframe');
  if (!iframe || iframe.hasAttribute('data-autoplay-applied')) return;

  try {
    // üîπ –®–∞–≥ 1: –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ URL
    var rawSrc = iframe.src;
    if (typeof rawSrc !== 'string') return;
    var cleanSrc = rawSrc.trim();
    if (!cleanSrc) return;

    var srcUrl = new URL(cleanSrc);
    var hostname = srcUrl.hostname;

    // üîπ –®–∞–≥ 2: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è URL –ø–æ–¥ embed + –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    var needReplace = false;

    // ‚Äî‚Äî‚Äî‚Äî‚Äî Rutube ‚Äî‚Äî‚Äî‚Äî‚Äî
    if (hostname.includes('rutube.ru')) {
      var path = srcUrl.pathname;
      var searchParams = srcUrl.searchParams;

      // –ò–∑–≤–ª–µ–∫–∞–µ–º video ID
      var videoId = searchParams.get('pl_video') ||                    // –∏–∑ /pl/?pl_video=ID
                    searchParams.get('v') ||                           // –Ω–∞ —Å–ª—É—á–∞–π v=ID
                    (path.match(/\/video\/([a-f0-9]{32})\//) || [])[1] || // /video/ID/
                    (path.match(/\/play\/embed\/([a-f0-9]{32})\//) || [])[1] || // —É–∂–µ embed
                    (path.match(/\/([a-f0-9]{32})\//) || [])[1];             // fallback

      if (videoId) {
        // –§–æ—Ä–º–∏—Ä—É–µ–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π embed-URL
        var newUrl = new URL('https://rutube.ru/play/embed/' + videoId + '/');
        // –ö–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º)
        ['start', 't'].forEach(function (key) {
          var val = searchParams.get(key);
          if (val) newUrl.searchParams.set(key, val);
        });
        srcUrl = newUrl;
        needReplace = true;
      } else {
        console.warn('Rutube: –Ω–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å video ID –∏–∑', cleanSrc);
      }
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî YouTube ‚Äî‚Äî‚Äî‚Äî‚Äî
    else if (hostname.includes('youtube.com') || hostname.includes('youtu.be')) {
      // –ü—Ä–∏–≤–æ–¥–∏–º –∫ embed-—Ñ–æ—Ä–º–∞—Ç—É
      if (srcUrl.pathname === '/watch' || hostname.includes('youtu.be')) {
        var v = srcUrl.searchParams.get('v') || (hostname.includes('youtu.be') ? srcUrl.pathname.substring(1) : null);
        if (v) {
          srcUrl = new URL('https://www.youtube.com/embed/' + v);
          needReplace = true;
        }
      }
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî VK (vkvideo.ru / vk.com/video_ext.php) ‚Äî‚Äî‚Äî‚Äî‚Äî
    else if (hostname.includes('vkvideo.ru') || (hostname.includes('vk.com') && srcUrl.pathname.includes('video_ext.php'))) {
      // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å ‚Äî VK –æ–±—ã—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ autoplay/muted –µ—Å—Ç—å
      // (–Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ–º, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ)
    }

    // üîπ –®–∞–≥ 3: –¥–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Ö –µ—â—ë –Ω–µ—Ç
    var sp = srcUrl.searchParams;
    var hadAutoplay = sp.has('autoplay');
    var hadMuted = sp.has('muted') || sp.has('mute');

    sp.set('autoplay', '1');
    sp.set('muted', '1');
    sp.set('playsinline', '1');

    // –î–ª—è YouTube: —Ç–∞–∫–∂–µ `mute=1` (–æ–Ω —á–∏—Ç–∞–µ—Ç `mute`, –∞ –Ω–µ `muted`)
    if (hostname.includes('youtube.com')) {
      sp.set('mute', '1');
      sp.set('enablejsapi', '1');
    }

    // –ï—Å–ª–∏ URL –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Äî –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å iframe
    if (needReplace || srcUrl.toString() !== cleanSrc) {
      var newIframe = document.createElement('iframe');
      newIframe.src = srcUrl.toString();
      newIframe.width = iframe.width || '100%';
      newIframe.height = iframe.height || '480';
      newIframe.setAttribute('frameborder', '0');
      newIframe.setAttribute('allowfullscreen', 'true');

      // üîπ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ `allow="autoplay; ‚Ä¶"`
      var currentAllow = iframe.getAttribute('allow') || '';
      var required = 'autoplay; fullscreen; picture-in-picture; encrypted-media';
      // –û–±—ä–µ–¥–∏–Ω—è–µ–º, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–µ–π
      var allowSet = new Set(
        (currentAllow + ';' + required)
          .split(';')
          .map(function (s) { return s.trim(); })
          .filter(Boolean)
      );
      newIframe.setAttribute('allow', Array.from(allowSet).join('; '));

      // –ó–∞–º–µ–Ω–∞
      iframe.replaceWith(newIframe);
      iframe = newIframe;
    } else {
      // URL –Ω–µ –º–µ–Ω—è–ª—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º allow, –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç autoplay
      var currentAllow = iframe.getAttribute('allow') || '';
      if (!currentAllow.includes('autoplay')) {
        iframe.setAttribute('allow', (currentAllow + '; autoplay; fullscreen; picture-in-picture; encrypted-media')
          .split(';')
          .map(function (s) { return s.trim(); })
          .filter(Boolean)
          .join('; ')
        );
      }
    }

    // üîπ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    iframe.setAttribute('data-autoplay-applied', 'true');

  } catch (err) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ iframe:', err, iframe && iframe.src);
  }
};












