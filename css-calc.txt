https://xn--h1alcedd.xn--d1aqf.xn--p1ai/instructions/usloviya-programmy-lgotnoy-ipoteki-dlya-it-spetsialistov/

/* eslint-disable */
import Vue from 'vue';
import initializationPolls from './modules/polls/custom-scripts/initialization-polls';
import SearchFamilyMortgage from './modules/search-family-mortgage/SearchFamilyMortgagePointEntry.vue';
import ItMortgageSurveysOneRequest from './modules/it-mortgage-surveys-one-request/ITMortgageSurveysPointEntry.vue';
import MinSport from './modules/minsport/MinsportPointEntry.vue';
import contentNote from './modules/content-note';
import dropDown from './modules/dropDown';
import {
  testPollsSlider, authorsSlider, cardSlider, cardSliderfoufcolumn,
} from './modules/swiper-sliders';
import slideConstructor from './modules/constructor-swiper';
import formRating from './modules/form-rating';
import popupGallery from './modules/popup-gallery';
import shareSocList from './modules/share-soc-list';
import instruction from './modules/redesign-site/instruction/instruction';
import commentsTexarea from './modules/comments-component/comments-texarea';

function dropDownTags() {
  const btnTags = document.querySelectorAll('.js--dropDown-btn');
  for (const item of btnTags) {
    item.onclick = (el) => {
      dropDown(el.target, 0);
    };
  }
}

// Вся инициализация — теперь здесь
export function init() {
  contentNote();
  dropDownTags();
  slideConstructor();
  testPollsSlider();
  initializationPolls();
  authorsSlider();
  formRating();
  cardSliderfoufcolumn();
  cardSlider();
  popupGallery();
  shareSocList();
  instruction();
  commentsTexarea();

  // === Ленивая загрузка TestN ===
  const vueTestRoots = document.querySelectorAll('.js-test-n');
  if (vueTestRoots.length > 0) {
    require.ensure([], (require) => {
      const TestN = require('./modules/test-n/TestN.vue').default;
      vueTestRoots.forEach((el, i) => {
        el.id = `test-n-${i}`;
        new Vue({ el: `#test-n-${i}`, components: { 'test-n': TestN } });
      });
    }, 'test-n-lazy');
  }

  // === Ленивая загрузка VPolls ===
  const vuePolls = document.querySelectorAll('.js-polls-n');
  if (vuePolls.length > 0) {
    require.ensure([], (require) => {
      const VPolls = require('./modules/polls/MainPolls.vue').default;
      vuePolls.forEach((el, i) => {
        el.classList.add(`js__polls-n-${i}`);
        new Vue({
          el: `.js__polls-n-${i}`,
          components: { 'v-polls': VPolls }
        });
      });
    }, 'v-polls-lazy');
  }

  // === Инициализация Vue-приложений по ID с надёжной проверкой ===
  function initSearchFamilyMortgage() {
    new Vue({
      el: '#search-family-mortgage',
      components: { 'search-family-mortgage': SearchFamilyMortgage }
    });
  }

  function initItMortgageSurveysOneRequest() {
    new Vue({
      el: '#v-mortgage-surveys-one-request',
      components: { 'it-mortgage-surveys-one-request': ItMortgageSurveysOneRequest }
    });
  }

  function initMinSport() {
    new Vue({
      el: '#v-minsport',
      components: { 'min-sport': MinSport }
    });
  }

  // Используем ваше имя переменной `obj`
  const obj = [
    { id: 'search-family-mortgage', fn: initSearchFamilyMortgage },
    { id: 'v-mortgage-surveys-one-request', fn: initItMortgageSurveysOneRequest },
    { id: 'v-minsport', fn: initMinSport },
    { id: 'form-rating', fn: formRating },
  ];

  // Надёжная инициализация: сначала проверяем наличие, потом ждём через observer
  obj.forEach(({ id, fn }) => {
    const el = document.getElementById(id);
    if (el && !el.__vue_initialized) {
      fn();
      el.__vue_initialized = true;
      return;
    }

    // Если элемента ещё нет — ждём его появления
    const observer = new MutationObserver(() => {
      const element = document.getElementById(id);
      if (element && !element.__vue_initialized) {
        observer.disconnect();
        fn();
        element.__vue_initialized = true;
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });
  });
}

// Автозапуск при импорте
init();

export default { init };

