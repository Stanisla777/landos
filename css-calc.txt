Демо-страницы с видео:
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-vkvideo-ru/
https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/testovoe-video-ot-rutube-ru/

Видео с локальными файлами:

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/sberezhenie-sredstv-v-krizisnoy-situatsii/

https://rssprosi-3100.sprosi.dev.ringsites.ahml.ru/education/video/keshbek-dlya-zhizni-kak-vernut-potrachennye-dengi/



// Создание popup’а (внутри fixed-контейнера)
function createShareDropdown(wrapper) {
  // === Парсинг data-services ===
  const servicesStr = (wrapper.dataset.services || '').trim();
  let services = [];
  if (servicesStr) {
    try {
      services = JSON.parse(servicesStr);
    } catch (_) {
      let cleaned = servicesStr.trim();
      if (cleaned.startsWith('[') && cleaned.endsWith(']')) {
        cleaned = cleaned.slice(1, -1).trim();
      }
      services = cleaned.split(',').map(s => s.trim()).filter(Boolean);
    }
  }
  if (!Array.isArray(services)) services = [];

  // === Данные (сырые — кодируем внутри getShareUrl) ===
  const rawUrl = wrapper.dataset.url || location.href;
  const rawText = wrapper.dataset.text || document.title;
  const rawImage = wrapper.dataset.image || '';

  // === DOM ===
  const dropdown = document.createElement('div');
  dropdown.className = 'soc-list__share';
  Object.assign(dropdown.style, {
    position: 'absolute',
    top: '0',
    left: '0',
    opacity: '0',
    pointerEvents: 'none',
  });

  const ul = document.createElement('ul');
  ul.style.margin = '0';
  ul.style.padding = '0';
  ul.style.listStyle = 'none';

  const serviceTitles = {
    whatsapp: 'WhatsApp',
    telegram: 'Telegram',
    vkontakte: 'ВКонтакте',
    odnoklassniki: 'Одноклассники',
  };

  services.forEach(service => {
    const title = serviceTitles[service];
    if (!title) return;

    const li = document.createElement('li');
    li.style.margin = '2px 0';

    const a = document.createElement('a');
    // ✅ Передаём СЫРЫЕ данные — кодируем внутри getShareUrl
    a.href = getShareUrl(service, { rawUrl, rawText, rawImage });
    a.target = '_blank';
    a.rel = 'noopener noreferrer';
    a.style.display = 'flex';
    a.style.alignItems = 'center';
    a.style.gap = '10px';
    a.style.padding = '6px 12px';
    a.style.textDecoration = 'none';
    a.style.color = 'inherit';

    const icon = document.createElement('div');
    icon.className = `soc-list__share-icon ${service}-icon-share`;
    icon.style.width = '24px';
    icon.style.height = '24px';
    icon.style.backgroundSize = 'contain';
    icon.style.backgroundRepeat = 'no-repeat';
    icon.style.backgroundPosition = 'center';

    const span = document.createElement('span');
    span.className = 'soc-list__share-title';
    span.textContent = title;

    a.appendChild(icon);
    a.appendChild(span);
    li.appendChild(a);
    ul.appendChild(li);
  });

  // === Копирование ссылки ===
  const copyLi = document.createElement('li');
  copyLi.style.margin = '2px 0';

  const copyDiv = document.createElement('div');
  copyDiv.className = 'soc-list__copy-link';
  copyDiv.dataset.copyLink = '';
  copyDiv.style.display = 'flex';
  copyDiv.style.alignItems = 'center';
  copyDiv.style.gap = '10px';
  copyDiv.style.padding = '6px 12px';
  copyDiv.style.cursor = 'pointer';

  const copyIcon = document.createElement('div');
  copyIcon.className = 'soc-list__share-icon copy-link';
  copyIcon.style.width = '24px';
  copyIcon.style.height = '24px';
  copyIcon.style.backgroundSize = 'contain';
  copyIcon.style.backgroundRepeat = 'no-repeat';
  copyIcon.style.backgroundPosition = 'center';

  const copyTitle = document.createElement('span');
  copyTitle.className = 'soc-list__share-title';
  copyTitle.textContent = 'Скопировать ссылку';

  copyDiv.appendChild(copyIcon);
  copyDiv.appendChild(copyTitle);
  copyLi.appendChild(copyDiv);
  ul.appendChild(copyLi);

  dropdown.appendChild(ul);

  // === Обработчик копирования (без изменений) ===
  copyDiv.addEventListener('click', function (ev) {
    ev.stopPropagation();

    const copy = () => {
      if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
        return navigator.clipboard.writeText(rawUrl);
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = rawUrl;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(textarea);
        return ok ? Promise.resolve() : Promise.reject(new Error('copy failed'));
      }
    };

    copy()
      .then(() => {
        copyTitle.textContent = 'Скопировано';
        setTimeout(() => {
          if (activeDropdown === dropdown) {
            hideDropdown(dropdown);
          }
        }, 500);
      })
      .catch(err => {
        console.warn('Не удалось скопировать:', err);
        copyTitle.textContent = 'Ошибка';
        setTimeout(() => {
          if (copyTitle.textContent === 'Ошибка') {
            copyTitle.textContent = 'Скопировать ссылку';
          }
        }, 1500);
      });
  });

  // === Закрытие по клику на соцсеть ===
  dropdown.addEventListener('click', (ev) => {
    if (ev.target.closest('a')) {
      hideDropdown(dropdown);
    }
  });

  // === Закрытие по клику вне ===
  const onClickOutside = (ev) => {
    if (activeDropdown === dropdown && !dropdown.contains(ev.target) && !ev.target.closest('.js--soc-list-share')) {
      hideDropdown(dropdown);
    }
  };
  document.addEventListener('click', onClickOutside);

  dropdown._cleanup = () => {
    document.removeEventListener('click', onClickOutside);
  };

  return dropdown;
}










