// Обработчик клика
function handleShareClick(trigger, e) {
  if (!trigger || typeof trigger.closest !== 'function') {
    console.warn('Некорректный триггер:', trigger);
    return;
  }
  e.preventDefault();
  const wrapper = trigger.closest('.js--soc-list-wrapper-share');
  if (!wrapper) return;

  if (activeDropdown && activeTrigger === trigger) {
    hideDropdown(activeDropdown);
    return;
  }

  if (activeDropdown) {
    hideDropdown(activeDropdown);
  }

  let dropdown = dropdownCache.get(wrapper);
  if (!dropdown) {
    // ✅ Получаем данные ОДИН РАЗ
    const rawUrl = wrapper.dataset.url || location.href;
    const rawText = wrapper.dataset.text || document.title;
    const rawImage = wrapper.dataset.image || '';

    dropdown = createShareDropdown(wrapper, rawUrl, rawText, rawImage);
    ensurePopupContainer().appendChild(dropdown);
    dropdownCache.set(wrapper, dropdown);
  }

  showDropdown(dropdown, trigger);
}
