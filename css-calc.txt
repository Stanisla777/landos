/* eslint-disable */
import AddClassBody from './redesign-site/disallow-body-scrolling';
import RemoveClassBody from './redesign-site/allow-body-scrolling';

// Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð´Ð²Ð¾Ð¹Ð½Ð¾Ð¹ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
let isInitialized = false;

export function closeModal(id) {
  const modalWindow = document.getElementById(id);
  if (!modalWindow) return;

  if (modalWindow.querySelector('.js--stories-body-video video')) {
    modalWindow.querySelector('.js--stories-body-video video').pause();
  }

  const promice = new Promise((resolve) => {
    if (modalWindow.classList.contains('open')) {
      if (modalWindow.querySelector('.select-list__selection-window')) {
        modalWindow.querySelector('.select-list__selection-window').classList.remove('opacity');
        setTimeout(() => {
          modalWindow.classList.remove('open');
        }, 200);
      } else {
        modalWindow.classList.remove('open');
      }
    } else if (modalWindow.classList.contains('show')) {
      modalWindow.classList.remove('show');
    }
    document.body.classList.remove('modal-opened', 'body-modal-not-remove', 'body-modal-not-remove-else');

    // ðŸ”¹ Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾ Ð»Ð¸ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ
    const mobileMenu = document.querySelector('.js--mobile-menu');
    const isMobileMenuOpen = mobileMenu && mobileMenu.classList.contains('active');

    // ðŸ”¹ Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð£Ð±Ñ€Ð°Ð»Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð½Ð° non-scroll-for-body
    // Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÐºÑ€Ð¾Ð»Ð» Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¾
    if (!isMobileMenuOpen && document.body.classList.contains('body-additional-class')) {

      // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ non-scroll-for-body, ÐµÑÐ»Ð¸ Ð¾Ð½ ÐµÑÑ‚ÑŒ
      if (document.body.classList.contains('non-scroll-for-body')) {
        document.body.classList.remove('non-scroll-for-body');
      }

      RemoveClassBody();
    }

    resolve();
  }).then(() =>
    new Promise((resolve) => {
      setTimeout(() => {
        resolve();
      }, 500);
    })
  );

  return promice;
}

export function modals() {
  if (isInitialized) return;
  isInitialized = true;

  // === 1. ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð¾Ð´Ð°Ð»Ð¾Ðº â€” Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ===
  document.addEventListener('click', (e) => {
    const opener = e.target.closest('.js--modal-opener[data-modal]');
    if (!opener) return;

    e.preventDefault();

    const modalSelector = opener.dataset.modal;
    const modal = document.querySelector(modalSelector);
    if (!modal) {
      return;
    }

    // ÐŸÐ¾Ð´ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹
    if (opener.dataset.program) {
      const input = document.querySelector('label.prog input');
      if (input) input.value = opener.dataset.program;
    }

    // ÐžÑ‚ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ
    modal.classList.add('open');

    // ÐÐ½Ð¸Ð¼Ð°Ñ†Ð¸Ñ select-list
    const selectWindow = modal.querySelector('.select-list__selection-window');
    if (selectWindow) {
      setTimeout(() => {
        selectWindow.classList.add('opacity');
      }, 400);
    }

    // Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° ÑÐºÑ€Ð¾Ð»Ð»Ð°
    document.body.classList.add(
      'modal-opened',
      'body-modal-not-remove-else',
      'body-modal-not-remove'
    );
    AddClassBody();
  });

  // === 2. Ð—Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ Ð¼Ð¾Ð´Ð°Ð»Ð¾Ðº â€” Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ===
  document.addEventListener('click', (e) => {
    // ÐšÐ½Ð¾Ð¿ÐºÐ° Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ñ
    const closer = e.target.closest('.js--modal-closer');
    if (closer) {
      const modal = closer.closest('.modal');
      if (modal) closeModal(modal.id);
      return;
    }

    // ÐšÐ»Ð¸Ðº Ð¿Ð¾ Ñ„Ð¾Ð½Ñƒ (Ð²Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ð³Ð¾)
    const modal = e.target.closest('.modal');
    if (modal && !e.target.closest('.js--modal, .modal__wrapper')) {
      closeModal(modal.id);
    }
  });
}

// Ð•ÑÐ»Ð¸ catalogModal Ñ‚Ð¾Ð¶Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ¾Ð¹ â€” ÐµÐ³Ð¾ Ñ‚Ð¾Ð¶Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
export function catalogModal() {
  // ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð´ÐµÐ»ÐµÐ³Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ»Ð¸Ðº Ð½Ð° Ð²ÐµÑÑŒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚
  document.addEventListener('click', (e) => {
    const opener = e.target.closest('.js--ct-modal-opener');
    if (!opener) return;

    const program = opener.getAttribute('data-program');
    const input = document.querySelector('label.prog input');
    if (program && input) {
      input.value = program;
    }

    const modal = document.querySelector('#modalcall');
    if (modal) {
      modal.classList.add('open');
      document.body.classList.add('modal-opened');
    }
  });
}

