// Созданю тултип
function createTooltip(content, trigger) {
  const tooltip = document.createElement('div');
  tooltip.className = 'content-note__text-new';

  // Добавляем классы из триггера, начинающиеся с 'class-for-tooltip-'
  if (trigger) {
    const triggerClasses = Array.from(trigger.classList);
    const tooltipClasses = triggerClasses.filter(className =>
      className.startsWith('class-for-tooltip-')
    );
    if (tooltipClasses.length > 0) {
      tooltip.classList.add(...tooltipClasses);
    }
  }

  // Проверяю, содержит ли контент HTML
  const hasHTML = /<[^>]+>/.test(content);
  const textLength = content.replace(/<[^>]+>/g, '').length;

  // Определяю тип позиционирования
  if (trigger && trigger.classList.contains('aside-location') && !hasHTML && textLength <= 40) {
    tooltip.classList.add('location-side');
  }

  // === СОЗДАЁМ СТРУКТУРУ МОБИЛЬНОГО ТУЛТИПА ===
  const isNarrow = window.matchMedia('(max-width: 480px)').matches;
  const isMobile = isMobilePhone() || isNarrow;

  if (isMobile) {
    // Мобильная структура
    const header = document.createElement('div');
    header.className = 'select-list__head';

    // === ДОБАВЛЯЕМ ЗАГОЛОВОК ТОЛЬКО ЕСЛИ ОН ЗАДАН ===
    if (trigger && trigger.dataset.contentTitle && trigger.dataset.contentTitle.trim()) {
      const title = document.createElement('p');
      title.textContent = trigger.dataset.contentTitle.trim();
      header.appendChild(title);
    }

    const closeBtn = document.createElement('div');
    closeBtn.className = 'select-list__head-close js--content-note-text-new-close';
    header.appendChild(closeBtn);

    const contentWrapper = document.createElement('div');
    contentWrapper.className = 'select-list__wr-search mor-rep-calculators__wr-search';
    contentWrapper.innerHTML = content;

    tooltip.appendChild(header);
    tooltip.appendChild(contentWrapper);
  } else {
    // Обычная структура для десктопа
    tooltip.innerHTML = content;
  }

  return tooltip;
}
