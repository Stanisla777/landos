instruction.js:
/* eslint-disable */
import Vue from 'vue'
import TestN from './modules/test-n/TestN.vue';
import VPolls from './modules/polls/MainPolls.vue';
import SearchFamilyMortgage from './modules/search-family-mortgage/SearchFamilyMortgagePointEntry.vue';
import ItMortgageSurveysOneRequest from './modules/it-mortgage-surveys-one-request/ITMortgageSurveysPointEntry.vue';
import MinSport from './modules/minsport/MinsportPointEntry.vue';
import contentNote from './modules/content-note';
import dropDown from './modules/dropDown';
import {
  mainBannerSlider, mainSlider, contentSlider, cardsInstructionSlider, cardsNewsSlider,
  aboutSlider, questionsAndAnswerSliders, testSlider, mediaSlider, eventPageSlider,
  educationalSlider, educationalSliderReviews, personalitiesSlider, slider4Col,
  birthdayReviewsSwiper, cardHousingCooperativeSlider, housingCooperativeListSlider,
  housingCooperativeDetailSlider, progressSlider, progressSlider4column, progressSliderPartners,
  testPollsSlider, progressSlider2, atAdvantageSwiper, atBecomeSwiper, atSliderPartners,
  SliderCourse, izhsMaterialSlider, izhsBunnersSlider, authorsSlider, authorsDetailedSliderDes,
  authorsDetailedSliderMob, newMarathonScheduleSlider, cardSlider, cardSliderfoufcolumn,
  atGameConsists, anotherThingPrizes
} from './modules/swiper-sliders';
import slideConstructor from './modules/constructor-swiper';
import formRating from './modules/form-rating';

function dropDownTags() {
  const btnTags = document.querySelectorAll('.js--dropDown-btn');
  // eslint-disable-next-line no-restricted-syntax
  for (const item of btnTags) {
    item.onclick = (el) => {
      // eslint-disable-next-line max-len
      // if (!el.target.classList.contains('js--footer-tags-link') && document.documentElement.clientWidth <= 480) {
      dropDown(el.target, 0);
      // }
    };
  }
}

document.addEventListener('DOMContentLoaded', () => {
  contentNote();
  dropDownTags();
  slideConstructor();
  testPollsSlider();
  authorsSlider();
  formRating();
  cardSliderfoufcolumn();

  // —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ vue –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ç–µ—Å—Ç–æ–≤ –≤ –Ω–∏—Ö
  const vueTestRoots = document.querySelectorAll('.js-test-n');

  if (vueTestRoots.length) {
    for (let i = 0; i < vueTestRoots.length; i += 1) {
      vueTestRoots[i].id = `test-n-${i}`;

      // eslint-disable-next-line no-new
      new Vue({
        el: `#test-n-${i}`,
        components: {
          'test-n': TestN,
        }
      });
    }
  }

  // —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ vue –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ç–µ—Å—Ç–æ–≤ –≤ –Ω–∏—Ö
  const vuePolls = document.querySelectorAll('.js-polls-n');

  if (vuePolls.length) {
    for (let i = 0; i < vuePolls.length; i += 1) {
      vuePolls[i].classList.add(`js__polls-n-${i}`);

      // eslint-disable-next-line no-new
      new Vue({
        el: `.js__polls-n-${i}`,
        components: {
          'v-polls': VPolls,
        }
      });
    }
  }

  function initSearchFamilyMortgage() {
    // eslint-disable-next-line no-new
    new Vue({
      el: '#search-family-mortgage',
      components: {
        'search-family-mortgage': SearchFamilyMortgage
      }
    });
  }

  function initItMortgageSurveysOneRequest() {
    // eslint-disable-next-line no-new
    new Vue({
      el: '#v-mortgage-surveys-one-request',
      components: {
        'it-mortgage-surveys-one-request': ItMortgageSurveysOneRequest
      }
    });
  }

  function initMinSport() {
    // eslint-disable-next-line no-new
    new Vue({
      el: '#v-minsport',
      components: {
        'min-sport': MinSport
      }
    });
  }

  const obj = [
    {
      id: 'search-family-mortgage',
      fn: initSearchFamilyMortgage
    },
    {
      id: 'v-mortgage-surveys-one-request',
      fn: initItMortgageSurveysOneRequest
    },
    {
      id: 'v-minsport',
      fn: initMinSport
    },
    {
      id: 'form-rating',
      fn: formRating
    },
  ]

  function waitForVueApp(id, initFn) {
    const el = document.getElementById(id);
    // eslint-disable-next-line no-underscore-dangle
    if (el && !el.__vue_initialized) {
      initFn();
      // eslint-disable-next-line no-underscore-dangle
      el.__vue_initialized = true;
      return;
    }

    const observer = new MutationObserver(() => {
      const element = document.getElementById(id);
      // eslint-disable-next-line no-underscore-dangle
      if (element && !element.__vue_initialized) {
        observer.disconnect();
        initFn();
        // eslint-disable-next-line no-underscore-dangle
        element.__vue_initialized = true;
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });
  }
  obj.forEach((item) => {
    waitForVueApp(item.id, item.fn);
  });
})

general.js
/* eslint-disable */
import Vue from 'vue';
import IMask from 'imask'
import selectsInit from './modules/selects-init';
import catalogNew from './modules/catalog-new';
import universalForm from './modules/universal-form/universal-form';
import leftSideBar from './modules/redesign-site/left-side-bar';
import headerMenu from './modules/redesign-site/header-menu';
import yandexSearch from './modules/redesign-site/yandex-search';
import anchors from './modules/anchors';
import {
  modals, closeModal, catalogModal
} from './modules/modals';
import cookies from './modules/cookies';
import playVideo from './modules/video/play-video';
import videoWithPreview from './modules/video/video-with-preview';
import footerDropDown from './modules/redesign-site/footer-drop-down';

Vue.config.productionTip = false;

document.addEventListener('DOMContentLoaded', () => {
  window.closeModal = closeModal;
  window.modals = modals;
  window.selectsInit = selectsInit;
  window.universalForm = universalForm;
  selectsInit();
  catalogNew();
  leftSideBar();
  headerMenu();
  yandexSearch();
  catalogModal();
  modals();
  anchors();
  cookies();
  playVideo();
  videoWithPreview();
  universalForm();
  footerDropDown();

})

webpack.js:

const path = require('path');
const fs = require('fs');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');
const CopyWebpackPlugin = require('copy-webpack-plugin');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
const TerserPlugin = require('terser-webpack-plugin');
const VueLoaderPlugin = require('vue-loader/lib/plugin');
// eslint-disable-next-line no-unused-vars
const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer');

function generateHtmlPlugins(templateDir) {
  const templateFiles = fs.readdirSync(path.resolve(__dirname, templateDir));
  return templateFiles.map((item) => {
    const parts = item.split('.');
    const name = parts[0];
    const extension = parts[1];
    return new HtmlWebpackPlugin({
      filename: `${name}.html`,
      template: path.resolve(__dirname, `${templateDir}/${name}.${extension}`),
      inject: false
    });
  });
}

const config = {
  // entry: ['./src/js/index.js', './src/scss/style.scss'], // —Å—Ç–∞—Ä–æ–µ
  entry: { // –Ω–æ–≤–æ–µ
    all: ['./src/js/index.js'], // ‚Üí bundle.js (legacy)
    'general-style': ['./src/scss/general-style.scss'], // ‚Üí general-style.css
    instruction: ['./src/scss/instruction.scss'], // ‚Üí instruction.css
    'general-js': './src/js/general.js', // ‚Üí general.bundle.js
    'instruction-js': './src/js/instruction.js' // ‚Üí instruction.bundle.js
  },
  output: {
    filename: './js/[name].bundle.js',
    // filename: './js/bundle.js',

    // 2023-04-25 fix –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ø—É—Ç–∏  –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ª–µ–Ω–∏–≤–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ apexchart –∏ js –≤–æ–æ–±—â–µ.
    // TODO: —Å–¥–µ–ª–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π fix –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –ø—É—Ç–∏ –∏ –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
    publicPath: '/dist/',
    // path: path.resolve(__dirname, 'dist'), // —Å —ç—Ç–∏–º —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
    // filename: 'js/bundle.js' // —Å —ç—Ç–∏–º —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
  },
  devtool: 'source-map',
  mode: 'production',
  optimization: {
    minimize: true,
    // splitChunks: {
    //   chunks: 'all'
    // },
    minimizer: [
      new TerserPlugin({
        parallel: true,
        cache: true
      })
      // new TerserPlugin({ parallel: true })
    ],
    splitChunks: {
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/](vue|axios|vue-axios|swiper|imask)[\\/]/,
          name: 'vendor-script',
          // üëá –ö–ª—é—á–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞: —Ç–æ–ª—å–∫–æ –¥–ª—è —á–∞–Ω–∫–æ–≤ 'general' –∏ 'instruction'
          chunks: (chunk) => chunk.name === 'general-js' || chunk.name === 'instruction-js',
          enforce: true
        }
      }
    }
  },
  performance: {
    hints: false
  },
  module: {
    rules: [
      {
        test: /\.vue$/,
        loader: 'vue-loader'
      },
      {
        test: /\.(sass|scss)$/,
        include: path.resolve(__dirname, 'src/scss'),
        use: [
          {
            loader: MiniCssExtractPlugin.loader,
            options: {}
          },
          {
            loader: 'css-loader',
            options: {
              sourceMap: true,
              url: false
            }
          },
          {
            loader: 'postcss-loader',
            options: {
              ident: 'postcss',
              sourceMap: true,
              plugins: () => [
                // eslint-disable-next-line global-require
                require('cssnano')({
                  preset: [
                    'default',
                    {
                      discardComments: {
                        removeAll: true
                      }
                    }
                  ]
                }),
                // –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
                // require('autoprefixer')({
                //   grid: true
                // })
              ]
            }
          },
          {
            loader: 'sass-loader',
            options: {
              sourceMap: true
            }
          }
        ]
      },
      {
        test: /\.pug$/,
        oneOf: [
          {
            include: path.resolve(__dirname, 'src/pug/'),
            exclude: /\.vue$/,
            use: ['pug-loader']
          },
          {
            use: ['pug-plain-loader']
          }
        ]
      },
      {
        enforce: 'pre',
        test: /\.js$/,
        exclude: /node_modules/,
        loader: 'eslint-loader',
        options: {
          // formatter: require("./.eslintrc.js")
          // cache: true
        }
      },
      {
        test: /\.js$/,
        exclude: /node_modules/,
        use: {
          loader: 'babel-loader'
        }
      },
      {
        test: /\.js$/,
        enforce: 'pre',
        use: ['source-map-loader'],
      },
      {
        test: /\.js$/,
        use: [{
          loader: 'cache-loader'
        }]
      },
      {
        test: /\.(sass|scss)$/,
        use: [{
          loader: 'cache-loader'
        }]
      },
      // {
      //   test: /\.pug$/,
      //   use: [{
      //     loader: 'cache-loader'
      //   }]
      // }
    ]
  },
  plugins: [
    new VueLoaderPlugin(),
    new MiniCssExtractPlugin({
      filename: './css/[name].css'
    }),
    new CopyWebpackPlugin([
      {
        from: './src/fonts',
        to: './fonts'
      },
      {
        from: './src/img',
        to: './img'
      }
    ]),
    {
      apply: (compiler) => {
        compiler.hooks.afterEmit.tap('RenameMainToBundle', () => {
          // eslint-disable-next-line no-shadow,global-require
          const fs = require('fs');
          // eslint-disable-next-line no-shadow,global-require
          const path = require('path');
          const mainPath = path.resolve(__dirname, 'dist/js/all.bundle.js');
          const bundlePath = path.resolve(__dirname, 'dist/js/bundle.js');
          if (fs.existsSync(mainPath)) {
            fs.renameSync(mainPath, bundlePath);
            console.log('‚úÖ all.bundle.js ‚Üí bundle.js');
          }
        });
      }
    },
    // —É–¥–∞–ª–µ–Ω–∏–µ JS –æ—Ç CSS-only entry
    {
      apply: (compiler) => {
        compiler.hooks.afterEmit.tap('CleanupCSSOnlyJS', () => {
          // eslint-disable-next-line no-shadow,global-require
          const fs = require('fs');
          // eslint-disable-next-line no-shadow,global-require
          const path = require('path');

          // –ò–º–µ–Ω–∞ entry, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –¢–û–õ–¨–ö–û CSS ‚Üí –∏—Ö JS-—Ñ–∞–π–ª—ã —É–¥–∞–ª—è–µ–º
          const cssOnlyEntries = [
            'general-style',
            'instruction'
            // –î–æ–±–∞–≤–ª—è–π—Ç–µ —Å—é–¥–∞ –Ω–æ–≤—ã–µ –ø–æ –º–µ—Ä–µ –ø–æ—è–≤–ª–µ–Ω–∏—è:
            // 'header',
            // 'footer',
            // 'news'
          ];

          cssOnlyEntries.forEach((name) => {
            const jsPath = path.resolve(compiler.outputPath, `js/${name}.bundle.js`);
            if (fs.existsSync(jsPath)) {
              fs.unlinkSync(jsPath);
              // console.log(`üßπ –£–¥–∞–ª—ë–Ω: ${name}.bundle.js`);
            }
          });
        });
      }
    }
    // new BundleAnalyzerPlugin()
  ],
  resolve: {
    alias: {
      vue: 'vue/dist/vue.js'
    }
  }
};

module.exports = (env, argv) => {
  if (argv.mode === 'production') {
    config.plugins.push(new CleanWebpackPlugin());
    config.resolve.alias.vue = 'vue/dist/vue.min.js';
    config.devtool = 'eval';
    // config.publicPath = './';
    // config.publicPath =  path.resolve(__dirname, 'dist');
  } else {
    config.plugins = config.plugins.concat(generateHtmlPlugins('./src/pug/views'));
  }
  return config;
};



