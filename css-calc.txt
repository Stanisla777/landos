// tooltipMobile.js

import bodyLockMobileFilter from './redesign-site/body-lock-mobile-filter';
import bodyUnlockMobileFilter from './redesign-site/body-unlock-mobile-filter';

// 👇 Импортируем напрямую функцию разблокировки body
import { RemoveClassBody } from './allow-body-scrolling'; // ← укажите правильный путь

function openTooltipMobile() {
  const array_mobile_tooltip = document.querySelectorAll('.js--open-mobile-tooltip');
  for (let item of array_mobile_tooltip) {
    item.onclick = () => {
      const parent = item.closest('.js--tooltip-parent');
      if (parent) {
        parent.classList.add('active');
        bodyLockMobileFilter(parent);
      }
    };
  }
}

function closeTooltipMobile() {
  const array_mobile_tooltip_close = document.querySelectorAll('.js--close-mobile-tooltip');
  for (let item of array_mobile_tooltip_close) {
    item.onclick = () => {
      const parent = item.closest('.js--tooltip-parent');
      if (parent) {
        parent.classList.remove('active');
        bodyUnlockMobileFilter(parent);
      }
    };
  }
}

// 🔥 Новая функция: закрыть всё и гарантированно разблокировать body
function closeAllMobileTooltips() {
  const activeParents = document.querySelectorAll('.js--tooltip-parent.active');
  if (activeParents.length > 0) {
    // Сначала убираем active у всех
    activeParents.forEach(parent => {
      parent.classList.remove('active');
    });

    // Затем — принудительно разблокируем body
    // (даже если bodyUnlockMobileFilter этого не сделает)
    RemoveClassBody();
  }
}

// Обработчик ресайза
function handleResize() {
  // Порог из ваших медиазапросов: 480px
  if (window.innerWidth > 480) {
    closeAllMobileTooltips();
  }
}

// Экспорт
export default function tooltipMobile() {
  openTooltipMobile();
  closeTooltipMobile();

  // Слушаем ресайз
  window.addEventListener('resize', handleResize);

  // На всякий случай: проверяем при инициализации
  if (window.innerWidth > 480) {
    closeAllMobileTooltips();
  }
}
