// Созданю тултип
function createTooltip(content, trigger) {
  const tooltip = document.createElement('div');
  tooltip.className = 'content-note__text-new';
  tooltip.style.cssText = `
    opacity: 0;
    pointerEvents: none;
    transition: opacity 0.2s ease, transform 0.2s ease;
  `;

  // Проверяю, содержит ли контент HTML
  const hasHTML = /<[^>]+>/.test(content);
  const textLength = content.replace(/<[^>]+>/g, '').length;

  // Определяю тип позиционирования
  // Тултип сбоку только если:
  // 1. У триггера есть класс aside-location
  // 2. В контенте нет HTML
  // 3. Длина текста <= 40 символов
  if (trigger && trigger.classList.contains('aside-location') && !hasHTML && textLength <= 40) {
    tooltip.classList.add('location-side');
  }

  // Добавляю контент
  tooltip.innerHTML = content;

  return tooltip;
}

// Показ тултипа
function showTooltip(trigger, content) {
  // Закрываю предыдущий тултип, если он есть
  if (activeTooltip) {
    hideTooltip(activeTooltip);
  }

  // Создаю новый тултип с контентом из data-content-text блока на который навели
  // Передаю триггер для проверки класса aside-location
  const tooltip = createTooltip(content, trigger);
  ensureTooltipContainer().appendChild(tooltip);

  // Позиционирую тултип относительно блока по которому кликнули
  positionTooltip(trigger, tooltip);

  // Показываю с анимацией небольшой
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      tooltip.style.opacity = '1';
      tooltip.style.pointerEvents = 'auto';
      tooltip.classList.add('active');
    });
  });

  // Сохраняю ссылки на текущий тултип 
  activeTooltip = tooltip;
  activeTrigger = trigger;

  // Для мобильных добавляю блокировку скролла
  if (isMobileDevice()) {
    addClassBody();
  }
}
