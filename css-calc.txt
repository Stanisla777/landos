ESLint: Parsing error: 'import' and 'export' may only appear at the top level
// eslint-disable-next-line no-unused-expressions

require.ensure([], (require) => {
    require('./lazy-instruction.js');
    console.log('✅ Instruction modules loaded');
  }, 'instruction-lazy');


Создайте src/js/lazy-instruction.js

// src/js/lazy-instruction.js
/* eslint-disable */
import Vue from 'vue';
import TestN from './modules/test-n/TestN.vue';
import VPolls from './modules/polls/MainPolls.vue';
import SearchFamilyMortgage from './modules/search-family-mortgage/SearchFamilyMortgagePointEntry.vue';
import ItMortgageSurveysOneRequest from './modules/it-mortgage-surveys-one-request/ITMortgageSurveysPointEntry.vue';
import MinSport from './modules/minsport/MinsportPointEntry.vue';
import contentNote from './modules/content-note';
import dropDown from './modules/dropDown';
import {
  mainBannerSlider, mainSlider, contentSlider, cardsInstructionSlider, cardsNewsSlider,
  aboutSlider, questionsAndAnswerSliders, testSlider, mediaSlider, eventPageSlider,
  educationalSlider, educationalSliderReviews, personalitiesSlider, slider4Col,
  birthdayReviewsSwiper, cardHousingCooperativeSlider, housingCooperativeListSlider,
  housingCooperativeDetailSlider, progressSlider, progressSlider4column, progressSliderPartners,
  testPollsSlider, progressSlider2, atAdvantageSwiper, atBecomeSwiper, atSliderPartners,
  SliderCourse, izhsMaterialSlider, izhsBunnersSlider, authorsSlider, authorsDetailedSliderDes,
  authorsDetailedSliderMob, newMarathonScheduleSlider, cardSlider, cardSliderfoufcolumn,
  atGameConsists, anotherThingPrizes
} from './modules/swiper-sliders';
import slideConstructor from './modules/constructor-swiper';
import formRating from './modules/form-rating';

function dropDownTags() {
  const btnTags = document.querySelectorAll('.js--dropDown-btn');
  for (const item of btnTags) {
    item.onclick = (el) => {
      dropDown(el.target, 0);
    };
  }
}

// Вся инициализация — теперь здесь
export function init() {
  contentNote();
  dropDownTags();
  slideConstructor();
  testPollsSlider();
  authorsSlider();
  formRating();
  cardSliderfoufcolumn();

  // Vue-аппы
  const vueTestRoots = document.querySelectorAll('.js-test-n');
  vueTestRoots.forEach((el, i) => {
    el.id = `test-n-${i}`;
    new Vue({ el: `#test-n-${i}`, components: { 'test-n': TestN } });
  });

  const vuePolls = document.querySelectorAll('.js-polls-n');
  vuePolls.forEach((el, i) => {
    el.classList.add(`js__polls-n-${i}`);
    new Vue({ el: `.js__polls-n-${i}`, components: { 'v-polls': VPolls } });
  });

  // Инициализация по ID
  function initSearchFamilyMortgage() {
    new Vue({
      el: '#search-family-mortgage',
      components: { 'search-family-mortgage': SearchFamilyMortgage }
    });
  }

  function initItMortgageSurveysOneRequest() {
    new Vue({
      el: '#v-mortgage-surveys-one-request',
      components: { 'it-mortgage-surveys-one-request': ItMortgageSurveysOneRequest }
    });
  }

  function initMinSport() {
    new Vue({
      el: '#v-minsport',
      components: { 'min-sport': MinSport }
    });
  }

  const obj = [
    { id: 'search-family-mortgage', fn: initSearchFamilyMortgage },
    { id: 'v-mortgage-surveys-one-request', fn: initItMortgageSurveysOneRequest },
    { id: 'v-minsport', fn: initMinSport },
    { id: 'form-rating', fn: formRating },
  ];

  function waitForVueApp(id, initFn) {
    const el = document.getElementById(id);
    if (el && !el.__vue_initialized) {
      initFn();
      el.__vue_initialized = true;
      return;
    }

    const observer = new MutationObserver(() => {
      const element = document.getElementById(id);
      if (element && !element.__vue_initialized) {
        observer.disconnect();
        initFn();
        element.__vue_initialized = true;
      }
    });

    observer.observe(document.body, { childList: true, subtree: true });
  }

  obj.forEach(item => waitForVueApp(item.id, item.fn));
}

// Автозапуск при импорте
init();

export default { init };

---------------------------------------------------------------------------------------
Обновите src/js/instruction.js

// src/js/instruction.js
/* eslint-disable */

// Ленивая загрузка — только если нужны элементы инструкций
document.addEventListener('DOMContentLoaded', () => {
  // Проверяем: есть ли на странице элементы, требующие этого JS?
  const needsInstructionJS = document.querySelector(`
    .js-test-n,
    .js-polls-n,
    #search-family-mortgage,
    #v-mortgage-surveys-one-request,
    #v-minsport,
    .instructions-content
  `);

  if (!needsInstructionJS) {
    console.log('ℹ️ Instruction JS not needed — skipped');
    return;
  }

  // Загружаем тяжёлый код только при необходимости
  import('./lazy-instruction.js')
    .then(() => console.log('✅ Instruction modules loaded'))
    .catch(err => console.error('❌ Failed to load instruction modules', err));
});

-------------------------------------

Обновите src/js/general.js — разделите на критичное / некритичное
// src/js/general.js
/* eslint-disable */
import Vue from 'vue';
import IMask from 'imask';
import selectsInit from './modules/selects-init';
import catalogNew from './modules/catalog-new';
import universalForm from './modules/universal-form/universal-form';
import leftSideBar from './modules/redesign-site/left-side-bar';
import headerMenu from './modules/redesign-site/header-menu';
import yandexSearch from './modules/redesign-site/yandex-search';
import anchors from './modules/anchors';
import { modals, closeModal, catalogModal } from './modules/modals';
import cookies from './modules/cookies';
import playVideo from './modules/video/play-video';
import videoWithPreview from './modules/video/video-with-preview';
import footerDropDown from './modules/redesign-site/footer-drop-down';

Vue.config.productionTip = false;

document.addEventListener('DOMContentLoaded', () => {
  // ✅ Критичное — сразу (для FCP/LCP)
  window.closeModal = closeModal;
  window.modals = modals;
  window.selectsInit = selectsInit;
  modals();           // ← нужно для header/hero
  headerMenu();       // ← шапка
  leftSideBar();      // ← если есть в above-the-fold

  // ⚠️ Некритичное — после загрузки страницы
  window.addEventListener('load', () => {
    selectsInit();
    catalogNew();
    yandexSearch();
    catalogModal();
    anchors();
    cookies();
    playVideo();
    videoWithPreview();
    universalForm();
    footerDropDown();
  });
});

<script src="/dist/js/vendor-script.bundle.js" defer></script>
<script src="/dist/js/general-js.bundle.js" defer></script>
<script src="/dist/js/instruction-js.bundle.js" defer></script>

----------------------------------------------

if (defined('IS_INSTRUCTIONS') && IS_INSTRUCTIONS === true):
?>
  <script src="<?= TMP_PATCH ?>js/vendor-script.bundle.js" defer></script>
  <script src="<?= TMP_PATCH ?>js/general-js.bundle.js" defer></script>
  <script src="<?= TMP_PATCH ?>js/instruction-js.bundle.js" defer></script>
<?php else: ?>
  <script src="<?= TMP_PATCH ?>js/bundle.js" defer></script>
<?php endif; ?>




