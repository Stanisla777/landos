const topOffset = rect.top + rect.height / 2;

if (viewportHeight / 2 < topOffset) {
  // Иконка ниже середины → тултип сверху - прижимаем к ВЕРХНЕМУ краю иконки
  tooltip.style.top = 'auto';
  tooltip.style.bottom = `${viewportHeight - rect.top + offset}px`;
  tooltip.classList.add('up');
  tooltip.classList.remove('down');
} else {
  // Иконка выше середины → тултип снизу - прижимаем к НИЖНЕМУ краю иконки
  tooltip.style.top = `${rect.bottom - offset}px`;
  tooltip.style.bottom = 'auto';
  tooltip.classList.add('down');
  tooltip.classList.remove('up');
}
